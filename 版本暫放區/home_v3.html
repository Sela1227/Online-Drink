{% extends "base.html" %}

{% block title %}é¦–é  - SELA å¿«é»ä¾†é»é¤{% endblock %}

{% block content %}
<div class="space-y-6">
    <!-- è¨‚é£²æ–™ -->
    {% if drink_groups %}
    <section>
        <h2 class="text-lg font-semibold text-gray-800 mb-3">ğŸ§‹ è¨‚é£²æ–™ <span class="text-sm font-normal text-gray-500">({{ drink_groups|length }})</span></h2>
        <div class="grid grid-cols-2 gap-3">
            {% for group in drink_groups %}
            {% include "partials/group_card.html" with context %}
            {% endfor %}
        </div>
    </section>
    {% endif %}

    <!-- è¨‚é¤ -->
    {% if meal_groups %}
    <section>
        <h2 class="text-lg font-semibold text-gray-800 mb-3">ğŸ± è¨‚é¤ <span class="text-sm font-normal text-gray-500">({{ meal_groups|length }})</span></h2>
        <div class="grid grid-cols-2 gap-3">
            {% for group in meal_groups %}
            {% include "partials/group_card.html" with context %}
            {% endfor %}
        </div>
    </section>
    {% endif %}
    
    <!-- åœ˜è³¼ -->
    {% if groupbuy_groups %}
    <section>
        <h2 class="text-lg font-semibold text-gray-800 mb-3">ğŸ›’ åœ˜è³¼ <span class="text-sm font-normal text-gray-500">({{ groupbuy_groups|length }})</span></h2>
        <div class="grid grid-cols-2 gap-3">
            {% for group in groupbuy_groups %}
            {% include "partials/group_card.html" with context %}
            {% endfor %}
        </div>
    </section>
    {% endif %}

    <!-- ç„¡é–‹æ”¾ä¸­çš„åœ˜ -->
    {% if not drink_groups and not meal_groups and not groupbuy_groups %}
    <div class="text-center py-12 text-gray-500">
        <p>ç›®å‰æ²’æœ‰é–‹æ”¾ä¸­çš„åœ˜</p>
        <p class="text-sm mt-1">é»æ“Šä¸Šæ–¹ã€Œé–‹åœ˜ã€æŒ‰éˆ•é–‹æ–°åœ˜ï¼</p>
    </div>
    {% endif %}

    <!-- å·²æˆªæ­¢ -->
    {% if closed_groups %}
    <section x-data="{ showClosed: false }">
        <h2 class="text-lg font-semibold text-gray-400 mb-3 cursor-pointer flex items-center gap-2" @click="showClosed = !showClosed">
            <span x-text="showClosed ? 'â–¼' : 'â–¶'" class="text-xs"></span>
            å·²æˆªæ­¢ <span class="text-sm font-normal">({{ closed_groups|length }})</span>
        </h2>
        <div x-show="showClosed" x-collapse class="grid grid-cols-2 gap-3 opacity-60">
            {% for group in closed_groups %}
            <a href="/groups/{{ group.id }}" 
               class="block bg-gray-100 rounded-lg p-3 shadow relative">
                <div class="flex items-start gap-2">
                    {% if group.store.logo_url %}
                    <img src="{{ group.store.logo_url }}" class="w-8 h-8 rounded object-contain bg-white flex-shrink-0">
                    {% endif %}
                    <div class="flex-1 min-w-0">
                        <div class="text-sm font-bold text-gray-600 truncate">{{ group.name }}</div>
                        <div class="text-xs text-gray-400">{{ group.store.name }}</div>
                    </div>
                </div>
                <div class="text-xs text-gray-400 mt-2">{{ group.owner.show_name }} Â· å·²æˆªæ­¢</div>
            </a>
            {% endfor %}
        </div>
    </section>
    {% endif %}
</div>

<script>
function countdown(deadline) {
    return {
        display: '',
        init() {
            this.update();
            setInterval(() => this.update(), 60000);
        },
        update() {
            const now = new Date();
            const end = new Date(deadline);
            const diff = end - now;
            
            if (diff <= 0) {
                this.display = 'å·²æˆªæ­¢';
                return;
            }
            
            const hours = Math.floor(diff / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            
            if (hours > 24) {
                const days = Math.floor(hours / 24);
                this.display = `${days}å¤©`;
            } else if (hours > 0) {
                this.display = `${hours}h ${minutes}m`;
            } else {
                this.display = `${minutes}m`;
            }
        }
    }
}
</script>
{% endblock %}
