{% extends "base.html" %}

{% block title %}æ”¶è—åº—å®¶ - SELA å¿«é»ä¾†é»é¤{% endblock %}

{% block content %}
<div class="space-y-4">
    <!-- æ¨™é¡Œåˆ— -->
    <div class="flex items-center justify-between">
        <h1 class="text-xl font-bold text-gray-800">â­ æ”¶è—åº—å®¶</h1>
        <a href="/profile" class="text-sm text-gray-500 hover:text-gray-700">â† è¿”å›</a>
    </div>
    
    {% if favorites %}
    <div class="space-y-3">
        {% for fav in favorites %}
        <div class="bg-white rounded-lg shadow-sm p-4">
            <div class="flex items-center gap-3">
                <!-- Logo -->
                <div class="w-12 h-12 bg-gray-100 rounded-lg flex items-center justify-center flex-shrink-0 overflow-hidden">
                    {% if fav.store.logo_url %}
                    <img src="{{ fav.store.logo_url }}" alt="{{ fav.store.name }}" class="w-full h-full object-contain">
                    {% else %}
                    <span class="text-2xl">
                        {% if fav.store.category and fav.store.category.value == 'drink' %}ğŸ§‹
                        {% elif fav.store.category and fav.store.category.value == 'meal' %}ğŸ±
                        {% else %}ğŸ›’{% endif %}
                    </span>
                    {% endif %}
                </div>
                
                <!-- è³‡è¨Š -->
                <div class="flex-1 min-w-0">
                    <div class="font-medium text-gray-800">{{ fav.store.name }}</div>
                    <div class="text-sm text-gray-500">
                        {% if fav.store.category and fav.store.category.value == 'drink' %}é£²æ–™åº—
                        {% elif fav.store.category and fav.store.category.value == 'meal' %}é¤å»³
                        {% else %}åœ˜è³¼{% endif %}
                    </div>
                </div>
                
                <!-- å–æ¶ˆæ”¶è—æŒ‰éˆ• -->
                <button onclick="toggleFavorite({{ fav.store.id }}, this)"
                        class="text-yellow-500 hover:text-gray-400 text-2xl">
                    â­
                </button>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="text-center py-12 text-gray-500">
        <p class="text-4xl mb-4">â­</p>
        <p>é‚„æ²’æœ‰æ”¶è—çš„åº—å®¶</p>
        <p class="text-sm mt-1">åœ¨é–‹åœ˜æ™‚é»æ“Šæ˜Ÿæ˜Ÿå³å¯æ”¶è—ï¼</p>
    </div>
    {% endif %}
</div>

<script>
async function toggleFavorite(storeId, btn) {
    try {
        const response = await fetch(`/favorites/${storeId}`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' }
        });
        const data = await response.json();
        
        if (data.status === 'removed') {
            // ç§»é™¤æ•´å€‹å¡ç‰‡
            btn.closest('.bg-white').remove();
        }
    } catch (err) {
        console.error('Toggle favorite failed:', err);
    }
}
</script>
{% endblock %}
