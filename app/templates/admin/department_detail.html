{% extends "base.html" %}

{% block title %}{{ department.name }} - éƒ¨é–€ç®¡ç†{% endblock %}

{% block content %}
<div class="space-y-4">
    <!-- æ¨™é¡Œåˆ— -->
    <div class="flex items-center justify-between">
        <div>
            <h1 class="text-xl font-bold text-gray-800">{{ department.name }}</h1>
            {% if department.description %}
            <p class="text-sm text-gray-500 mt-1">{{ department.description }}</p>
            {% endif %}
        </div>
        <a href="/admin/departments" class="text-sm text-gray-500 hover:text-gray-700">â† è¿”å›</a>
    </div>
    
    <!-- æ–°å¢æˆå“¡ -->
    <div class="bg-white rounded-lg shadow-sm p-4">
        <h2 class="font-medium text-gray-800 mb-3">â• æ–°å¢æˆå“¡</h2>
        <form action="/admin/departments/{{ department.id }}/members" method="POST" class="flex gap-2">
            <select name="user_id" required class="flex-1 border border-gray-300 rounded-lg px-3 py-2 text-sm">
                <option value="">é¸æ“‡ç”¨æˆ¶</option>
                {% for user in available_users %}
                <option value="{{ user.id }}">{{ user.show_name }}</option>
                {% endfor %}
            </select>
            <select name="role" class="border border-gray-300 rounded-lg px-3 py-2 text-sm">
                <option value="member">æˆå“¡</option>
                <option value="leader">å°çµ„é•·</option>
            </select>
            <button type="submit" class="bg-orange-500 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-orange-600">
                æ–°å¢
            </button>
        </form>
    </div>
    
    <!-- æˆå“¡åˆ—è¡¨ -->
    {% if members %}
    <div class="bg-white rounded-lg shadow-sm divide-y">
        {% for m in members %}
        <div class="p-4 flex items-center justify-between">
            <div class="flex items-center gap-3">
                {% if m.user.picture_url %}
                <img src="{{ m.user.picture_url }}" class="w-10 h-10 rounded-full">
                {% else %}
                <div class="w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center">ğŸ‘¤</div>
                {% endif %}
                <div>
                    <div class="font-medium text-gray-800">{{ m.user.show_name }}</div>
                    <div class="text-xs text-gray-400">
                        {% if m.role.value == 'leader' %}
                        <span class="text-orange-500">â­ å°çµ„é•·</span>
                        {% else %}
                        æˆå“¡
                        {% endif %}
                        Â· åŠ å…¥æ–¼ {{ m.joined_at.strftime('%Y/%m/%d') }}
                    </div>
                </div>
            </div>
            
            <div class="flex items-center gap-2">
                <!-- åˆ‡æ›è§’è‰² -->
                <form action="/admin/departments/{{ department.id }}/members/{{ m.id }}/toggle-role" method="POST" class="inline">
                    <button type="submit" class="text-sm text-blue-500 hover:text-blue-600">
                        {% if m.role.value == 'leader' %}é™ç‚ºæˆå“¡{% else %}å‡ç‚ºå°çµ„é•·{% endif %}
                    </button>
                </form>
                
                <!-- ç§»é™¤ -->
                <form action="/admin/departments/{{ department.id }}/members/{{ m.id }}/remove" method="POST" class="inline"
                      onsubmit="return confirm('ç¢ºå®šè¦ç§»é™¤æ­¤æˆå“¡ï¼Ÿ')">
                    <button type="submit" class="text-sm text-red-500 hover:text-red-600">ç§»é™¤</button>
                </form>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="text-center py-12 text-gray-500">
        <p>é‚„æ²’æœ‰æˆå“¡</p>
    </div>
    {% endif %}
    
    <!-- éƒ¨é–€è¨­å®š -->
    <div class="bg-white rounded-lg shadow-sm p-4">
        <h2 class="font-medium text-gray-800 mb-3">âš™ï¸ éƒ¨é–€è¨­å®š</h2>
        <form action="/admin/departments/{{ department.id }}/update" method="POST" class="space-y-3">
            <div>
                <label class="block text-sm text-gray-600 mb-1">éƒ¨é–€åç¨±</label>
                <input type="text" name="name" value="{{ department.name }}" required
                       class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm">
            </div>
            <div>
                <label class="block text-sm text-gray-600 mb-1">èªªæ˜</label>
                <input type="text" name="description" value="{{ department.description or '' }}"
                       class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm">
            </div>
            <div class="flex items-center gap-2">
                <input type="checkbox" name="is_public" id="is_public" value="1"
                       {% if department.is_public %}checked{% endif %}>
                <label for="is_public" class="text-sm text-gray-600">å…¬é–‹éƒ¨é–€ï¼ˆæ‰€æœ‰äººéƒ½å¯åŠ å…¥ï¼‰</label>
            </div>
            <button type="submit" class="bg-orange-500 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-orange-600">
                å„²å­˜
            </button>
        </form>
    </div>
</div>
{% endblock %}
