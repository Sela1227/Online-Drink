{% extends "base.html" %}

{% block title %}{{ target_user.display_name }} - ä½¿ç”¨è€…è©³æƒ…{% endblock %}

{% block content %}
<div class="space-y-4">
    <div>
        <a href="/admin/users" class="text-sm text-gray-500 hover:text-gray-700">â† è¿”å›ä½¿ç”¨è€…åˆ—è¡¨</a>
        <h1 class="text-xl font-bold text-gray-800">ä½¿ç”¨è€…è©³æƒ…</h1>
    </div>
    
    <!-- åŸºæœ¬è³‡è¨Š -->
    <div class="bg-white rounded-lg shadow-sm p-4">
        <div class="flex items-start gap-4">
            <!-- é ­åƒ -->
            <div class="relative w-16 h-16 flex-shrink-0">
                <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center overflow-hidden">
                    {% if target_user.picture_url %}
                    <img src="{{ target_user.picture_url }}" alt="{{ target_user.display_name }}" class="w-full h-full object-cover">
                    {% else %}
                    <span class="text-2xl">ğŸ‘¤</span>
                    {% endif %}
                </div>
                {% if target_user.is_online %}
                <div class="absolute -bottom-0.5 -right-0.5 w-4 h-4 bg-green-500 border-2 border-white rounded-full"></div>
                {% endif %}
            </div>
            
            <!-- åç¨±èˆ‡æ¨™ç±¤ -->
            <div class="flex-1">
                <div class="text-lg font-bold text-gray-900">
                    {{ target_user.show_name }}
                    {% if target_user.is_admin %}
                    <span class="text-xs bg-amber-100 text-amber-700 px-1.5 py-0.5 rounded ml-1">ç®¡ç†å“¡</span>
                    {% endif %}
                    {% if target_user.is_online %}
                    <span class="text-xs bg-green-100 text-green-700 px-1.5 py-0.5 rounded ml-1">ğŸŸ¢ åœ¨ç·š</span>
                    {% endif %}
                </div>
                {% if target_user.nickname %}
                <div class="text-sm text-gray-500">LINE åç¨±ï¼š{{ target_user.display_name }}</div>
                {% endif %}
            </div>
        </div>
        
        <!-- çµ±è¨ˆ -->
        <div class="grid grid-cols-2 gap-4 mt-4">
            <div class="bg-gray-50 rounded-lg p-3 text-center">
                <div class="text-2xl font-bold text-orange-600">{{ order_count }}</div>
                <div class="text-xs text-gray-500">åƒèˆ‡è¨‚å–®</div>
            </div>
            <div class="bg-gray-50 rounded-lg p-3 text-center">
                <div class="text-2xl font-bold text-orange-600">{{ group_count }}</div>
                <div class="text-xs text-gray-500">é–‹éçš„åœ˜</div>
            </div>
        </div>
    </div>
    
    <!-- ç™»å…¥è³‡è¨Š -->
    <div class="bg-white rounded-lg shadow-sm p-4">
        <h2 class="font-semibold text-gray-800 mb-3">ğŸ” ç™»å…¥è³‡è¨Š</h2>
        <div class="space-y-2 text-sm">
            <div class="flex justify-between py-2 border-b">
                <span class="text-gray-500">LINE User ID</span>
                <span class="text-gray-700 font-mono text-xs">{{ target_user.line_user_id }}</span>
            </div>
            <div class="flex justify-between py-2 border-b">
                <span class="text-gray-500">å¸³è™Ÿå»ºç«‹æ™‚é–“</span>
                <span class="text-gray-700">{{ (target_user.created_at|taipei).strftime('%Y-%m-%d %H:%M:%S') }}</span>
            </div>
            <div class="flex justify-between py-2 border-b">
                <span class="text-gray-500">æœ€å¾Œç™»å…¥æ™‚é–“</span>
                <span class="text-gray-700">
                    {% if target_user.last_login_at %}
                    {{ (target_user.last_login_at|taipei).strftime('%Y-%m-%d %H:%M:%S') }}
                    {% else %}
                    <span class="text-gray-400">å°šæœªè¨˜éŒ„</span>
                    {% endif %}
                </span>
            </div>
            <div class="flex justify-between py-2 border-b">
                <span class="text-gray-500">æœ€å¾Œæ´»å‹•æ™‚é–“</span>
                <span class="text-gray-700">
                    {% if target_user.last_active_at %}
                    {{ (target_user.last_active_at|taipei).strftime('%Y-%m-%d %H:%M:%S') }}
                    {% else %}
                    <span class="text-gray-400">å°šæœªè¨˜éŒ„</span>
                    {% endif %}
                </span>
            </div>
            <div class="flex justify-between py-2">
                <span class="text-gray-500">åœ¨ç·šç‹€æ…‹</span>
                <span class="{% if target_user.is_online %}text-green-600{% else %}text-gray-400{% endif %}">
                    {% if target_user.is_online %}ğŸŸ¢ åœ¨ç·š{% else %}âš« é›¢ç·š{% endif %}
                </span>
            </div>
        </div>
    </div>
    
    <!-- æœ€è¿‘é–‹çš„åœ˜ -->
    {% if groups %}
    <div class="bg-white rounded-lg shadow-sm p-4">
        <h2 class="font-semibold text-gray-800 mb-3">ğŸ“‹ æœ€è¿‘é–‹çš„åœ˜ï¼ˆ{{ group_count }}ï¼‰</h2>
        <div class="space-y-2">
            {% for g in groups %}
            <a href="/groups/{{ g.id }}" class="block p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition">
                <div class="flex justify-between items-center">
                    <div>
                        <div class="font-medium text-gray-800">{{ g.name }}</div>
                        <div class="text-xs text-gray-500">{{ g.store.name }} Â· {{ g.created_at.strftime('%m/%d %H:%M') }}</div>
                    </div>
                    <div class="text-xs px-2 py-1 rounded
                        {% if g.is_open %}bg-green-100 text-green-700{% else %}bg-gray-100 text-gray-500{% endif %}">
                        {% if g.is_open %}é€²è¡Œä¸­{% else %}å·²æˆªæ­¢{% endif %}
                    </div>
                </div>
            </a>
            {% endfor %}
        </div>
    </div>
    {% endif %}
    
    <!-- æœ€è¿‘è¨‚å–® -->
    {% if orders %}
    <div class="bg-white rounded-lg shadow-sm p-4">
        <h2 class="font-semibold text-gray-800 mb-3">ğŸ›’ æœ€è¿‘è¨‚å–®ï¼ˆ{{ order_count }}ï¼‰</h2>
        <div class="space-y-2">
            {% for order in orders %}
            <a href="/groups/{{ order.group_id }}" class="block p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition">
                <div class="flex justify-between items-center">
                    <div>
                        <div class="font-medium text-gray-800">{{ order.group.name }}</div>
                        <div class="text-xs text-gray-500">{{ order.created_at.strftime('%m/%d %H:%M') }} Â· {{ order.items|length }} å“é … Â· ${{ order.total_amount }}</div>
                    </div>
                    <div class="text-xs px-2 py-1 rounded
                        {% if order.status.value == 'submitted' %}bg-green-100 text-green-700
                        {% elif order.status.value == 'editing' %}bg-amber-100 text-amber-700
                        {% else %}bg-gray-100 text-gray-500{% endif %}">
                        {% if order.status.value == 'submitted' %}å·²çµå–®
                        {% elif order.status.value == 'editing' %}ä¿®æ”¹ä¸­
                        {% else %}è‰ç¨¿{% endif %}
                    </div>
                </div>
            </a>
            {% endfor %}
        </div>
    </div>
    {% endif %}
    
    <!-- ç®¡ç†æ“ä½œ -->
    {% if target_user.id != user.id %}
    <div class="bg-white rounded-lg shadow-sm p-4">
        <h2 class="font-semibold text-gray-800 mb-3">âš™ï¸ ç®¡ç†æ“ä½œ</h2>
        <form action="/admin/users/{{ target_user.id }}/toggle-admin" method="post"
              onsubmit="return confirm('ç¢ºå®šè¦{{ 'ç§»é™¤' if target_user.is_admin else 'è¨­ç‚º' }}ç®¡ç†å“¡å—ï¼Ÿ')">
            <button type="submit" class="w-full py-2 rounded-lg text-sm font-medium transition
                {% if target_user.is_admin %}
                bg-gray-100 text-gray-700 hover:bg-gray-200
                {% else %}
                bg-amber-50 text-amber-700 hover:bg-amber-100
                {% endif %}">
                {% if target_user.is_admin %}ç§»é™¤ç®¡ç†å“¡æ¬Šé™{% else %}è¨­ç‚ºç®¡ç†å“¡{% endif %}
            </button>
        </form>
    </div>
    {% endif %}
</div>
{% endblock %}
