{% extends "base.html" %}

{% block title %}å•é¡Œå›å ±ç®¡ç† - SELA{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <div class="flex items-center justify-between mb-4">
        <h1 class="text-xl font-bold text-gray-800">ğŸ“‹ å•é¡Œå›å ±ç®¡ç†</h1>
        <a href="/admin" class="text-orange-600 text-sm">â† è¿”å›å¾Œå°</a>
    </div>
    
    <!-- ç‹€æ…‹ç¯©é¸ -->
    <div class="flex gap-2 mb-4 overflow-x-auto">
        <a href="/feedback/admin" 
           class="px-3 py-1 rounded-full text-sm whitespace-nowrap
                  {% if not selected_status %}bg-orange-500 text-white{% else %}bg-gray-200 text-gray-700{% endif %}">
            å…¨éƒ¨
        </a>
        <a href="/feedback/admin?status=open"
           class="px-3 py-1 rounded-full text-sm whitespace-nowrap
                  {% if selected_status == 'open' %}bg-yellow-500 text-white{% else %}bg-yellow-100 text-yellow-700{% endif %}">
            ğŸ”´ å¾…è™•ç†
        </a>
        <a href="/feedback/admin?status=in_progress"
           class="px-3 py-1 rounded-full text-sm whitespace-nowrap
                  {% if selected_status == 'in_progress' %}bg-blue-500 text-white{% else %}bg-blue-100 text-blue-700{% endif %}">
            ğŸ”µ è™•ç†ä¸­
        </a>
        <a href="/feedback/admin?status=resolved"
           class="px-3 py-1 rounded-full text-sm whitespace-nowrap
                  {% if selected_status == 'resolved' %}bg-green-500 text-white{% else %}bg-green-100 text-green-700{% endif %}">
            ğŸŸ¢ å·²è§£æ±º
        </a>
    </div>
    
    <!-- å•é¡Œåˆ—è¡¨ -->
    {% if feedbacks %}
    <div class="space-y-4">
        {% for fb in feedbacks %}
        <div class="bg-white rounded-xl shadow p-4">
            <div class="flex items-start justify-between mb-2">
                <div>
                    <div class="flex items-center gap-2 mb-1">
                        {% if fb.type.value == 'bug' %}
                        <span class="text-red-500">ğŸ›</span>
                        {% elif fb.type.value == 'suggestion' %}
                        <span class="text-blue-500">ğŸ’¡</span>
                        {% else %}
                        <span class="text-gray-500">ğŸ“‹</span>
                        {% endif %}
                        <span class="font-semibold">{{ fb.title }}</span>
                    </div>
                    <div class="text-xs text-gray-500">
                        {{ fb.user.display_name }} Â· {{ (fb.created_at|taipei).strftime('%Y/%m/%d %H:%M') }}
                    </div>
                </div>
                <span class="text-xs px-2 py-1 rounded-full
                    {% if fb.status.value == 'open' %}bg-yellow-100 text-yellow-700
                    {% elif fb.status.value == 'in_progress' %}bg-blue-100 text-blue-700
                    {% elif fb.status.value == 'resolved' %}bg-green-100 text-green-700
                    {% else %}bg-gray-100 text-gray-700{% endif %}">
                    {% if fb.status.value == 'open' %}å¾…è™•ç†
                    {% elif fb.status.value == 'in_progress' %}è™•ç†ä¸­
                    {% elif fb.status.value == 'resolved' %}å·²è§£æ±º
                    {% else %}å·²é—œé–‰{% endif %}
                </span>
            </div>
            
            <p class="text-sm text-gray-700 mb-3 whitespace-pre-wrap">{{ fb.content }}</p>
            
            <!-- ç®¡ç†è¡¨å–® -->
            <form action="/feedback/admin/{{ fb.id }}/update" method="POST" 
                  class="border-t pt-3 mt-3 flex flex-wrap gap-2 items-end">
                <div class="flex-1 min-w-[200px]">
                    <label class="block text-xs text-gray-500 mb-1">ç‹€æ…‹</label>
                    <select name="status" class="w-full border rounded px-2 py-1 text-sm">
                        <option value="open" {% if fb.status.value == 'open' %}selected{% endif %}>å¾…è™•ç†</option>
                        <option value="in_progress" {% if fb.status.value == 'in_progress' %}selected{% endif %}>è™•ç†ä¸­</option>
                        <option value="resolved" {% if fb.status.value == 'resolved' %}selected{% endif %}>å·²è§£æ±º</option>
                        <option value="closed" {% if fb.status.value == 'closed' %}selected{% endif %}>å·²é—œé–‰</option>
                    </select>
                </div>
                <div class="flex-[2] min-w-[200px]">
                    <label class="block text-xs text-gray-500 mb-1">å›è¦†</label>
                    <input type="text" name="admin_note" value="{{ fb.admin_note or '' }}"
                           class="w-full border rounded px-2 py-1 text-sm"
                           placeholder="çµ¦ç”¨æˆ¶çš„å›è¦†...">
                </div>
                <button type="submit" 
                        class="bg-orange-500 text-white px-4 py-1 rounded text-sm hover:bg-orange-600">
                    æ›´æ–°
                </button>
            </form>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="text-center py-8 text-gray-500">
        <div class="text-4xl mb-2">âœ¨</div>
        <p>ç›®å‰æ²’æœ‰å•é¡Œå›å ±</p>
    </div>
    {% endif %}
</div>
{% endblock %}
