{% extends "base.html" %}

{% block title %}å•é¡Œå›å ±ç®¡ç† - SELA å¿«é»ä¾†é»é¤{% endblock %}

{% block content %}
<div class="space-y-4">
    <!-- æ¨™é¡Œåˆ— -->
    <div class="flex items-center justify-between">
        <h1 class="text-xl font-bold text-gray-800">ğŸ“® å•é¡Œå›å ±</h1>
        <a href="/admin" class="text-sm text-gray-500 hover:text-gray-700">è¿”å›ç®¡ç†å¾Œå° â†’</a>
    </div>
    
    <!-- æœ€è¿‘å›å ±ï¼ˆæœ€å¤š5ç­†ï¼‰ -->
    {% if recent_feedbacks %}
    <div class="space-y-3">
        {% for feedback in recent_feedbacks %}
        <div class="bg-white rounded-lg shadow-sm p-4 {% if feedback.status == 'resolved' %}opacity-60{% endif %}"
             x-data="{ copied: false }">
            <div class="flex items-start justify-between gap-3">
                <div class="flex-1 min-w-0">
                    <!-- ç”¨æˆ¶è³‡è¨Š -->
                    <div class="flex items-center gap-2 mb-2">
                        {% if feedback.user.picture_url %}
                        <img src="{{ feedback.user.picture_url }}" class="w-6 h-6 rounded-full">
                        {% endif %}
                        <span class="font-medium text-gray-700">{{ feedback.user.show_name }}</span>
                        <span class="text-xs text-gray-400">{{ feedback.created_at.strftime('%Y/%m/%d %H:%M') }}</span>
                    </div>
                    
                    <!-- å…§å®¹ -->
                    <p class="text-sm text-gray-700 whitespace-pre-line">{{ feedback.content }}</p>
                </div>
                
                <!-- æ“ä½œæŒ‰éˆ• -->
                <div class="flex flex-col gap-2 flex-shrink-0">
                    <!-- è¤‡è£½æŒ‰éˆ• -->
                    <button @click="
                        const text = `[{{ feedback.user.show_name }}] {{ feedback.created_at.strftime('%m/%d %H:%M') }}\n{{ feedback.content }}`;
                        navigator.clipboard.writeText(text);
                        copied = true;
                        setTimeout(() => copied = false, 2000);
                    " class="text-xs px-3 py-1 rounded border transition"
                       :class="copied ? 'bg-green-100 text-green-600 border-green-300' : 'bg-gray-50 text-gray-600 hover:bg-gray-100 border-gray-200'">
                        <span x-show="!copied">ğŸ“‹ è¤‡è£½</span>
                        <span x-show="copied" x-cloak>âœ“ å·²è¤‡è£½</span>
                    </button>
                    
                    <!-- ç‹€æ…‹/è™•ç† -->
                    {% if feedback.status == 'resolved' %}
                    <span class="text-xs bg-green-100 text-green-600 px-3 py-1 rounded text-center">å·²è™•ç†</span>
                    {% else %}
                    <form action="/admin/feedbacks/{{ feedback.id }}/resolve" method="POST">
                        <button type="submit" class="text-xs bg-orange-500 text-white px-3 py-1 rounded hover:bg-orange-600 w-full">
                            æ¨™è¨˜å·²è™•ç†
                        </button>
                    </form>
                    {% endif %}
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="text-center py-12 text-gray-500 bg-white rounded-lg">
        <div class="text-4xl mb-2">ğŸ‰</div>
        <p>ç›®å‰æ²’æœ‰å•é¡Œå›å ±</p>
    </div>
    {% endif %}
    
    <!-- æ­·å²ç´€éŒ„ -->
    {% if history_feedbacks %}
    <div x-data="{ showHistory: false }">
        <button @click="showHistory = !showHistory" 
                class="w-full py-3 bg-gray-100 hover:bg-gray-200 rounded-lg text-sm text-gray-600 font-medium transition">
            <span x-show="!showHistory">ğŸ“‚ é¡¯ç¤ºæ­·å²ç´€éŒ„ ({{ history_feedbacks|length }} ç­†)</span>
            <span x-show="showHistory" x-cloak>ğŸ“ æ”¶èµ·æ­·å²ç´€éŒ„</span>
        </button>
        
        <div x-show="showHistory" x-cloak x-collapse class="mt-3 space-y-3">
            {% for feedback in history_feedbacks %}
            <div class="bg-gray-50 rounded-lg p-4 {% if feedback.status == 'resolved' %}opacity-60{% endif %}"
                 x-data="{ copied: false }">
                <div class="flex items-start justify-between gap-3">
                    <div class="flex-1 min-w-0">
                        <!-- ç”¨æˆ¶è³‡è¨Š -->
                        <div class="flex items-center gap-2 mb-2">
                            {% if feedback.user.picture_url %}
                            <img src="{{ feedback.user.picture_url }}" class="w-6 h-6 rounded-full">
                            {% endif %}
                            <span class="font-medium text-gray-600">{{ feedback.user.show_name }}</span>
                            <span class="text-xs text-gray-400">{{ feedback.created_at.strftime('%Y/%m/%d %H:%M') }}</span>
                        </div>
                        
                        <!-- å…§å®¹ -->
                        <p class="text-sm text-gray-600 whitespace-pre-line">{{ feedback.content }}</p>
                    </div>
                    
                    <!-- æ“ä½œæŒ‰éˆ• -->
                    <div class="flex flex-col gap-2 flex-shrink-0">
                        <!-- è¤‡è£½æŒ‰éˆ• -->
                        <button @click="
                            const text = `[{{ feedback.user.show_name }}] {{ feedback.created_at.strftime('%m/%d %H:%M') }}\n{{ feedback.content }}`;
                            navigator.clipboard.writeText(text);
                            copied = true;
                            setTimeout(() => copied = false, 2000);
                        " class="text-xs px-3 py-1 rounded border transition"
                           :class="copied ? 'bg-green-100 text-green-600 border-green-300' : 'bg-gray-50 text-gray-500 hover:bg-gray-100 border-gray-300'">
                            <span x-show="!copied">ğŸ“‹ è¤‡è£½</span>
                            <span x-show="copied" x-cloak>âœ“ å·²è¤‡è£½</span>
                        </button>
                        
                        <!-- ç‹€æ…‹ -->
                        {% if feedback.status == 'resolved' %}
                        <span class="text-xs bg-green-100 text-green-600 px-3 py-1 rounded text-center">å·²è™•ç†</span>
                        {% else %}
                        <form action="/admin/feedbacks/{{ feedback.id }}/resolve" method="POST">
                            <button type="submit" class="text-xs bg-orange-500 text-white px-3 py-1 rounded hover:bg-orange-600 w-full">
                                æ¨™è¨˜å·²è™•ç†
                            </button>
                        </form>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}
