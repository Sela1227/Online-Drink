{% extends "base.html" %}

{% block title %}åŒ¯å…¥{% if selected_store %}èœå–® - {{ selected_store.name }}{% else %}åº—å®¶/èœå–®{% endif %} - SELA å¿«é»ä¾†é»é¤{% endblock %}

{% block content %}
<div class="space-y-4">
    <div class="flex items-center justify-between">
        {% if selected_store %}
        <h1 class="text-xl font-bold text-gray-800">åŒ¯å…¥èœå–®</h1>
        <a href="/admin/stores/{{ selected_store.id }}" class="text-sm text-gray-500 hover:text-gray-700">è¿”å› {{ selected_store.name }} â†’</a>
        {% else %}
        <h1 class="text-xl font-bold text-gray-800">åŒ¯å…¥åº—å®¶/èœå–®</h1>
        <a href="/admin" class="text-sm text-gray-500 hover:text-gray-700">è¿”å›ç®¡ç†å¾Œå° â†’</a>
        {% endif %}
    </div>
    
    {% if selected_store %}
    <!-- ç›®æ¨™åº—å®¶è³‡è¨Š -->
    <div class="bg-orange-50 border border-orange-200 rounded-lg p-4 flex items-center gap-3">
        <div class="w-12 h-12 bg-white rounded-lg flex items-center justify-center overflow-hidden">
            {% if selected_store.logo_url %}
            <img src="{{ selected_store.logo_url }}" alt="{{ selected_store.name }}" class="w-full h-full object-contain p-1">
            {% else %}
            <span class="text-2xl">
                {% if selected_store.category and selected_store.category.value == 'drink' %}ğŸ§‹
                {% elif selected_store.category and selected_store.category.value == 'group_buy' %}ğŸ›’
                {% else %}ğŸ±{% endif %}
            </span>
            {% endif %}
        </div>
        <div>
            <div class="font-medium text-gray-800">{{ selected_store.name }}</div>
            <div class="text-sm text-orange-600">èœå–®å°‡åŒ¯å…¥åˆ°æ­¤åº—å®¶</div>
        </div>
    </div>
    {% endif %}
    
    <!-- èªªæ˜ -->
    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 text-sm text-blue-800">
        <div class="font-medium mb-2">ğŸ“ åŒ¯å…¥æ ¼å¼èªªæ˜</div>
        {% if selected_store %}
        <p>è«‹ä¸Šå‚³åŒ…å« <code>menu</code> æ¬„ä½çš„ JSON æª”æ¡ˆï¼Œèœå–®å°‡åŒ¯å…¥åˆ° <strong>{{ selected_store.name }}</strong></p>
        {% else %}
        <p class="mb-2">æ”¯æ´å…©ç¨®åŒ¯å…¥æ–¹å¼ï¼š</p>
        <ol class="list-decimal list-inside space-y-1">
            <li><strong>å®Œæ•´åŒ¯å…¥</strong>ï¼šåº—å®¶ + èœå–®ä¸€èµ·å»ºç«‹ï¼ˆåŒ…å« <code>store</code> æ¬„ä½ï¼‰</li>
            <li><strong>èœå–®åŒ¯å…¥</strong>ï¼šåƒ…åŒ¯å…¥èœå–®åˆ°æ—¢æœ‰åº—å®¶ï¼ˆåŒ…å« <code>store_id</code> æ¬„ä½ï¼‰</li>
        </ol>
        {% endif %}
    </div>
    
    <!-- ç¯„ä¾‹æ ¼å¼ -->
    <details class="bg-white rounded-lg shadow-sm">
        <summary class="p-4 cursor-pointer font-medium text-gray-700">ğŸ“‹ æŸ¥çœ‹ç¯„ä¾‹æ ¼å¼</summary>
        <div class="px-4 pb-4 space-y-4">
            <!-- å®Œæ•´åŒ¯å…¥ç¯„ä¾‹ -->
            <div>
                <div class="text-sm font-medium text-gray-600 mb-2">å®Œæ•´åŒ¯å…¥ï¼ˆåº—å®¶ + èœå–®ï¼‰</div>
                <pre class="text-xs bg-gray-50 p-3 rounded overflow-x-auto">{
  "store": {
    "name": "å¯ä¸å¯ç†Ÿæˆç´…èŒ¶",
    "category": "drink",
    "logo_url": null,
    "sugar_options": ["æ­£å¸¸ç³–", "å°‘ç³–", "åŠç³–", "å¾®ç³–", "ç„¡ç³–"],
    "ice_options": ["æ­£å¸¸å†°", "å°‘å†°", "å¾®å†°", "å»å†°", "ç†±"]
  },
  "menu": {
    "categories": [
      {
        "name": "ç†Ÿæˆç´…èŒ¶",
        "items": [
          { "name": "ç†Ÿæˆç´…èŒ¶", "price": 30, "price_l": 35 },
          { "name": "ç†Ÿæˆå†·éœ²", "price": 35 }
        ]
      }
    ]
  }
}</pre>
            </div>
            
            <!-- èœå–®åŒ¯å…¥ç¯„ä¾‹ -->
            <div>
                <div class="text-sm font-medium text-gray-600 mb-2">èœå–®åŒ¯å…¥ï¼ˆæ—¢æœ‰åº—å®¶ï¼‰</div>
                <pre class="text-xs bg-gray-50 p-3 rounded overflow-x-auto">{
  "store_id": 1,
  "mode": "new",
  "menu": {
    "categories": [
      {
        "name": "ä¾¿ç•¶é¡",
        "items": [
          {
            "name": "é›è…¿ä¾¿ç•¶",
            "price": 100,
            "options": [
              { "name": "åŠ é£¯", "price_diff": 10 },
              { "name": "ä¸è¦é¦™èœ", "price_diff": 0 }
            ]
          }
        ]
      }
    ]
  }
}</pre>
            </div>
        </div>
    </details>
    
    <!-- åŒ¯å…¥è¡¨å–® -->
    <form action="/admin/import/preview" method="post" enctype="multipart/form-data" 
          class="bg-white rounded-lg shadow-sm p-4 space-y-4"
          x-data="{ hasFile: false, fileName: '' }">
        
        {% if selected_store_id %}
        <input type="hidden" name="store_id" value="{{ selected_store_id }}">
        {% endif %}
        
        <!-- æª”æ¡ˆä¸Šå‚³ -->
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">ä¸Šå‚³ JSON æª”æ¡ˆ</label>
            <input type="file" name="json_file" accept=".json" required
                   @change="hasFile = $event.target.files.length > 0; fileName = $event.target.files[0]?.name || ''"
                   class="w-full border rounded-lg px-3 py-2">
            <p x-show="fileName" class="text-sm text-gray-500 mt-1" x-text="'å·²é¸æ“‡ï¼š' + fileName"></p>
        </div>
        
        <button type="submit" 
                x-show="hasFile"
                x-transition
                class="w-full py-3 rounded-lg bg-orange-500 hover:bg-orange-600 text-white font-medium">
            é è¦½åŒ¯å…¥å…§å®¹
        </button>
    </form>
</div>
{% endblock %}
