{% extends "base.html" %}

{% block title %}å…¬å‘Šç®¡ç† - SELA å¿«é»ä¾†é»é¤{% endblock %}

{% block content %}
<div class="space-y-4">
    <!-- æ¨™é¡Œåˆ— -->
    <div class="flex items-center justify-between">
        <h1 class="text-xl font-bold text-gray-800">ğŸ“¢ å…¬å‘Šç®¡ç†</h1>
        <a href="/admin" class="text-sm text-gray-500 hover:text-gray-700">è¿”å›ç®¡ç†å¾Œå° â†’</a>
    </div>
    
    <!-- æ–°å¢å…¬å‘Š -->
    <div class="bg-white rounded-lg shadow-sm p-4">
        <h2 class="font-medium text-gray-800 mb-3">â• æ–°å¢å…¬å‘Š</h2>
        <form action="/admin/announcements" method="POST" class="space-y-3">
            <div>
                <input type="text" name="title" required placeholder="å…¬å‘Šæ¨™é¡Œ"
                       class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-orange-500 focus:border-transparent">
            </div>
            <div>
                <textarea name="content" rows="3" required placeholder="å…¬å‘Šå…§å®¹..."
                          class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-orange-500 focus:border-transparent"></textarea>
            </div>
            <div class="flex flex-wrap gap-4 text-sm">
                <label class="flex items-center gap-2 cursor-pointer">
                    <input type="checkbox" name="is_pinned" value="true">
                    <span class="text-gray-600">ğŸ“Œ ç½®é ‚</span>
                </label>
                <div class="flex items-center gap-2">
                    <span class="text-gray-600">éæœŸæ™‚é–“ï¼ˆé¸å¡«ï¼‰</span>
                    <input type="datetime-local" name="expires_at"
                           class="border border-gray-300 rounded px-2 py-1 text-sm">
                </div>
            </div>
            <div class="flex justify-end">
                <button type="submit" class="bg-orange-500 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-orange-600">
                    ç™¼å¸ƒå…¬å‘Š
                </button>
            </div>
        </form>
    </div>
    
    <!-- å…¬å‘Šåˆ—è¡¨ -->
    <div class="bg-white rounded-lg shadow-sm">
        <div class="p-4 border-b">
            <h2 class="font-medium text-gray-800">å…¬å‘Šåˆ—è¡¨</h2>
        </div>
        
        {% if announcements %}
        <div class="divide-y">
            {% for ann in announcements %}
            <div class="p-4 {% if not ann.is_active %}opacity-50{% endif %}">
                <div class="flex items-start justify-between gap-3">
                    <div class="flex-1">
                        <div class="flex items-center gap-2 mb-1">
                            {% if ann.is_pinned %}
                            <span class="text-xs bg-red-100 text-red-600 px-1.5 py-0.5 rounded">ğŸ“Œ ç½®é ‚</span>
                            {% endif %}
                            {% if ann.is_active %}
                            <span class="text-xs bg-green-100 text-green-600 px-1.5 py-0.5 rounded">é¡¯ç¤ºä¸­</span>
                            {% else %}
                            <span class="text-xs bg-gray-100 text-gray-500 px-1.5 py-0.5 rounded">å·²åœç”¨</span>
                            {% endif %}
                            <span class="font-medium text-gray-800">{{ ann.title }}</span>
                        </div>
                        <div class="text-sm text-gray-600 whitespace-pre-line">{{ ann.content }}</div>
                        <div class="text-xs text-gray-400 mt-2">
                            {{ ann.created_by.show_name }} Â· {{ ann.created_at.strftime('%Y/%m/%d %H:%M') }}
                            {% if ann.expires_at %}
                            Â· éæœŸï¼š{{ ann.expires_at.strftime('%m/%d %H:%M') }}
                            {% endif %}
                        </div>
                    </div>
                    <div class="flex flex-col gap-1">
                        <a href="/admin/announcements/{{ ann.id }}/edit" 
                           class="text-xs px-3 py-1 rounded border hover:bg-gray-50 w-full text-center">
                            âœï¸ ç·¨è¼¯
                        </a>
                        <form action="/admin/announcements/{{ ann.id }}/toggle" method="POST">
                            <button type="submit" class="text-xs px-3 py-1 rounded border hover:bg-gray-50 w-full">
                                {% if ann.is_active %}åœç”¨{% else %}å•Ÿç”¨{% endif %}
                            </button>
                        </form>
                        {% if ann.is_active and not ann.is_pinned %}
                        <form action="/admin/announcements/{{ ann.id }}/pin" method="POST">
                            <button type="submit" class="text-xs px-3 py-1 rounded border hover:bg-gray-50 w-full">
                                ğŸ“Œ ç½®é ‚
                            </button>
                        </form>
                        {% elif ann.is_pinned %}
                        <form action="/admin/announcements/{{ ann.id }}/unpin" method="POST">
                            <button type="submit" class="text-xs px-3 py-1 rounded border hover:bg-gray-50 w-full">
                                å–æ¶ˆç½®é ‚
                            </button>
                        </form>
                        {% endif %}
                        <form action="/admin/announcements/{{ ann.id }}/delete" method="POST"
                              onsubmit="return confirm('ç¢ºå®šè¦åˆªé™¤æ­¤å…¬å‘Šå—ï¼Ÿ')">
                            <button type="submit" class="text-xs px-3 py-1 rounded border text-red-500 hover:bg-red-50 w-full">
                                åˆªé™¤
                            </button>
                        </form>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="p-8 text-center text-gray-500">
            <div class="text-4xl mb-2">ğŸ“¢</div>
            <p>å°šæœªç™¼å¸ƒä»»ä½•å…¬å‘Š</p>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
