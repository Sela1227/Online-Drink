{% extends "base.html" %}

{% block title %}åº—å®¶æ¨è–¦å¯©æ ¸ - SELA å¿«é»ä¾†é»é¤{% endblock %}

{% block content %}
<div class="space-y-4">
    <!-- æ¨™é¡Œåˆ— -->
    <div class="flex items-center justify-between">
        <h1 class="text-xl font-bold text-gray-800">ğŸ’¡ åº—å®¶æ¨è–¦å¯©æ ¸</h1>
        <a href="/admin" class="text-sm text-gray-500 hover:text-gray-700">è¿”å›ç®¡ç†å¾Œå° â†’</a>
    </div>
    
    <!-- å¾…å¯©æ ¸ -->
    <div class="bg-white rounded-lg shadow-sm">
        <div class="p-4 border-b flex items-center justify-between">
            <h2 class="font-medium text-gray-800">â³ å¾…å¯©æ ¸</h2>
            <span class="text-sm text-gray-500">{{ pending|length }} ä»¶</span>
        </div>
        
        {% if pending %}
        <div class="divide-y">
            {% for rec in pending %}
            <div class="p-4">
                <div class="flex items-start justify-between gap-3">
                    <div class="flex-1">
                        <div class="flex items-center gap-2 mb-1 flex-wrap">
                            <span class="font-bold text-gray-800 text-lg">{{ rec.store_name }}</span>
                            <span class="text-xs px-1.5 py-0.5 rounded
                                {% if rec.category == 'drink' %}bg-amber-100 text-amber-600
                                {% elif rec.category == 'meal' %}bg-green-100 text-green-600
                                {% else %}bg-blue-100 text-blue-600{% endif %}">
                                {% if rec.category == 'drink' %}ğŸ§‹ é£²æ–™
                                {% elif rec.category == 'meal' %}ğŸ± é¤å»³
                                {% else %}ğŸ›’ åœ˜è³¼{% endif %}
                            </span>
                        </div>
                        
                        {% if rec.menu_url %}
                        <div class="mb-2">
                            <a href="{{ rec.menu_url }}" target="_blank" 
                               class="text-sm text-blue-600 hover:underline break-all">
                                ğŸ”— {{ rec.menu_url[:50] }}{% if rec.menu_url|length > 50 %}...{% endif %}
                            </a>
                        </div>
                        {% endif %}
                        
                        {% if rec.menu_image_url %}
                        <div class="mb-2">
                            <a href="{{ rec.menu_image_url }}" target="_blank">
                                <img src="{{ rec.menu_image_url }}" alt="èœå–®åœ–ç‰‡" 
                                     class="max-w-full h-auto max-h-48 rounded-lg border shadow-sm">
                            </a>
                        </div>
                        {% endif %}
                        
                        {% if rec.note %}
                        <div class="text-sm text-gray-600 mb-2 bg-gray-50 rounded p-2">
                            ğŸ’¬ {{ rec.note }}
                        </div>
                        {% endif %}
                        
                        <div class="text-xs text-gray-400">
                            æ¨è–¦äººï¼š{{ rec.user.show_name }} Â· {{ rec.created_at.strftime('%Y/%m/%d %H:%M') }}
                        </div>
                    </div>
                    
                    <div class="flex flex-col gap-2 flex-shrink-0">
                        <form action="/admin/recommendations/{{ rec.id }}/approve" method="POST">
                            <button type="submit" class="w-full px-4 py-2 bg-green-500 text-white rounded-lg text-sm font-medium hover:bg-green-600">
                                âœ… æ ¸å‡†
                            </button>
                        </form>
                        
                        <div x-data="{ showReject: false }">
                            <button @click="showReject = !showReject" type="button" 
                                    class="w-full px-4 py-2 border border-red-300 text-red-500 rounded-lg text-sm hover:bg-red-50">
                                âŒ æ‹’çµ•
                            </button>
                            <form x-show="showReject" x-collapse
                                  action="/admin/recommendations/{{ rec.id }}/reject" method="POST" class="mt-2">
                                <input type="text" name="reject_reason" placeholder="æ‹’çµ•åŸå› ï¼ˆé¸å¡«ï¼‰"
                                       class="w-full border border-gray-300 rounded px-2 py-1 text-sm mb-1">
                                <button type="submit" class="w-full px-3 py-1 bg-red-500 text-white rounded text-sm">
                                    ç¢ºèªæ‹’çµ•
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="p-8 text-center text-gray-500">
            <div class="text-4xl mb-2">âœ¨</div>
            <p>æ²’æœ‰å¾…å¯©æ ¸çš„æ¨è–¦</p>
        </div>
        {% endif %}
    </div>
    
    <!-- å·²è™•ç† -->
    {% if processed %}
    <div class="bg-white rounded-lg shadow-sm">
        <div class="p-4 border-b">
            <h2 class="font-medium text-gray-800">ğŸ“‹ æœ€è¿‘è™•ç†</h2>
        </div>
        <div class="divide-y">
            {% for rec in processed %}
            <div class="p-4 {% if rec.status == 'rejected' %}opacity-60{% endif %}">
                <div class="flex items-center justify-between gap-3">
                    <div class="flex-1">
                        <div class="flex items-center gap-2">
                            <span class="font-medium text-gray-800">{{ rec.store_name }}</span>
                            {% if rec.status == 'approved' %}
                            <span class="text-xs px-1.5 py-0.5 rounded bg-green-100 text-green-600">âœ… å·²æ ¸å‡†</span>
                            {% else %}
                            <span class="text-xs px-1.5 py-0.5 rounded bg-red-100 text-red-600">âŒ å·²æ‹’çµ•</span>
                            {% endif %}
                        </div>
                        <div class="text-xs text-gray-400 mt-1">
                            {{ rec.user.show_name }} Â· {{ rec.reviewed_at.strftime('%Y/%m/%d %H:%M') if rec.reviewed_at else '' }}
                            {% if rec.reject_reason %} Â· åŸå› ï¼š{{ rec.reject_reason }}{% endif %}
                        </div>
                    </div>
                    {% if rec.status == 'approved' and rec.created_store_id %}
                    <a href="/admin/stores/{{ rec.created_store_id }}" class="text-sm text-orange-600 hover:underline">
                        æŸ¥çœ‹åº—å®¶ â†’
                    </a>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}
