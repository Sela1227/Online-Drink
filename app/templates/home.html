{% extends "base.html" %}

{% block title %}首頁 - SELA 快點來點餐{% endblock %}

{% block content %}
<div id="group-list" 
     hx-get="/home/groups" 
     hx-trigger="refreshGroups from:body"
     hx-swap="innerHTML">
    {% include "partials/home_groups.html" %}
</div>

<script>
let refreshScheduled = false;

function countdown(deadline) {
    return {
        display: '',
        init() {
            this.update();
            setInterval(() => this.update(), 60000);
        },
        update() {
            const now = new Date();
            const end = new Date(deadline);
            const diff = end - now;
            
            if (diff <= 0) {
                this.display = '已截止';
                // 觸發首頁刷新（防止重複觸發）
                if (!refreshScheduled) {
                    refreshScheduled = true;
                    setTimeout(() => {
                        htmx.trigger('#group-list', 'refreshGroups');
                        refreshScheduled = false;
                    }, 2000);
                }
                return;
            }
            
            const hours = Math.floor(diff / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            
            if (hours > 24) {
                const days = Math.floor(hours / 24);
                this.display = `${days}天`;
            } else if (hours > 0) {
                this.display = `${hours}h ${minutes}m`;
            } else {
                this.display = `${minutes}m`;
            }
        }
    }
}
</script>
{% endblock %}
