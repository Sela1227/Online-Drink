{% extends "base.html" %}

{% block title %}æ–°å¢é–‹åœ˜æ¨¡æ¿ - SELA å¿«é»ä¾†é»é¤{% endblock %}

{% block content %}
<div class="bg-white rounded-lg shadow-sm p-4">
    <div class="flex items-center justify-between mb-4">
        <h1 class="text-xl font-bold text-gray-800">ğŸ“‹ æ–°å¢é–‹åœ˜æ¨¡æ¿</h1>
        <a href="/templates" class="text-sm text-gray-500 hover:text-gray-700">è¿”å›æ¨¡æ¿åˆ—è¡¨ â†’</a>
    </div>
    
    <form action="/templates" method="post" class="space-y-4" x-data="templateForm()">
        <!-- æ¨¡æ¿åç¨± -->
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">æ¨¡æ¿åç¨±</label>
            <input type="text" name="template_name" required placeholder="ä¾‹ï¼šæ¯é€±äº”ä¸‹åˆèŒ¶"
                   class="w-full border rounded-lg px-3 py-2">
        </div>
        
        <!-- é¸æ“‡åº—å®¶ -->
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">é¸æ“‡åº—å®¶</label>
            <select name="store_id" x-model="storeId" @change="onStoreChange()" required
                    class="w-full border rounded-lg px-3 py-2">
                <option value="">è«‹é¸æ“‡...</option>
                {% for store in stores %}
                <option value="{{ store.id }}" 
                        data-category="{{ store.category.value }}">
                    {% if store.category.value == 'drink' %}ğŸ§‹
                    {% elif store.category.value == 'meal' %}ğŸ±
                    {% else %}ğŸ›’{% endif %}
                    {{ store.name }}
                </option>
                {% endfor %}
            </select>
        </div>
        
        <!-- é è¨­åœ˜å -->
        <div x-show="storeId" x-cloak>
            <label class="block text-sm font-medium text-gray-700 mb-2">é è¨­åœ˜å</label>
            <input type="text" name="group_name" required placeholder="ä¾‹ï¼šä¸‹åˆèŒ¶åœ˜"
                   class="w-full border rounded-lg px-3 py-2">
        </div>
        
        <!-- é è¨­é–‹æ”¾æ™‚é–“ -->
        <div x-show="storeId" x-cloak>
            <label class="block text-sm font-medium text-gray-700 mb-2">é è¨­é–‹æ”¾æ™‚é–“</label>
            <div class="flex items-center gap-2">
                <select name="default_duration" class="border rounded-lg px-3 py-2">
                    <option value="30">30 åˆ†é˜</option>
                    <option value="60" selected>1 å°æ™‚</option>
                    <option value="90">1.5 å°æ™‚</option>
                    <option value="120">2 å°æ™‚</option>
                    <option value="180">3 å°æ™‚</option>
                </select>
            </div>
        </div>
        
        <!-- å‚™è¨» -->
        <div x-show="storeId" x-cloak>
            <label class="block text-sm font-medium text-gray-700 mb-2">å‚™è¨»ï¼ˆé¸å¡«ï¼‰</label>
            <textarea name="note" rows="2" placeholder="ä¾‹ï¼šå–é¤åœ°é»åœ¨ 3F èŒ¶æ°´é–“"
                      class="w-full border rounded-lg px-3 py-2 text-sm"></textarea>
        </div>
        
        <!-- é£²æ–™è¨­å®š -->
        <div x-show="storeId && storeCategory === 'drink'" x-cloak 
             class="p-4 bg-amber-50 rounded-lg space-y-3">
            <h3 class="font-medium text-gray-700">é£²æ–™åœ˜è¨­å®š</h3>
            <div class="grid grid-cols-2 gap-3">
                <div>
                    <label class="block text-xs text-gray-600 mb-1">é è¨­ç”œåº¦</label>
                    <select name="default_sugar" class="w-full border rounded px-2 py-1 text-sm">
                        <option value="">ä¸æŒ‡å®š</option>
                        <option value="æ­£å¸¸ç³–">æ­£å¸¸ç³–</option>
                        <option value="å°‘ç³–">å°‘ç³–</option>
                        <option value="åŠç³–">åŠç³–</option>
                        <option value="å¾®ç³–">å¾®ç³–</option>
                        <option value="ç„¡ç³–">ç„¡ç³–</option>
                    </select>
                </div>
                <div>
                    <label class="block text-xs text-gray-600 mb-1">é è¨­å†°å¡Š</label>
                    <select name="default_ice" class="w-full border rounded px-2 py-1 text-sm">
                        <option value="">ä¸æŒ‡å®š</option>
                        <option value="æ­£å¸¸å†°">æ­£å¸¸å†°</option>
                        <option value="å°‘å†°">å°‘å†°</option>
                        <option value="å¾®å†°">å¾®å†°</option>
                        <option value="å»å†°">å»å†°</option>
                        <option value="ç†±">ç†±</option>
                    </select>
                </div>
            </div>
            <div class="flex gap-4">
                <label class="flex items-center gap-2 text-sm">
                    <input type="checkbox" name="lock_sugar" value="true">
                    <span>é–å®šç”œåº¦</span>
                </label>
                <label class="flex items-center gap-2 text-sm">
                    <input type="checkbox" name="lock_ice" value="true">
                    <span>é–å®šå†°å¡Š</span>
                </label>
            </div>
        </div>
        
        <!-- è¶£å‘³åŠŸèƒ½ -->
        <div x-show="storeId" x-cloak class="p-4 bg-purple-50 rounded-lg space-y-3">
            <h3 class="font-medium text-purple-700">ğŸ‰ è¶£å‘³åŠŸèƒ½</h3>
            
            <label class="flex items-center gap-2 text-sm">
                <input type="checkbox" name="is_blind_mode" value="true">
                <span>ğŸ™ˆ ç›²é»æ¨¡å¼</span>
            </label>
            
            <div x-data="{ enableLucky: false }">
                <label class="flex items-center gap-2 text-sm">
                    <input type="checkbox" name="enable_lucky_draw" value="true"
                           @change="enableLucky = $event.target.checked">
                    <span>ğŸŠ éš¨æ©Ÿå…å–®</span>
                </label>
                <div x-show="enableLucky" class="mt-2 ml-6 flex items-center gap-2">
                    <span class="text-sm">å…å–®</span>
                    <input type="number" name="lucky_draw_count" value="1" min="1" max="5"
                           class="w-14 border rounded px-2 py-1 text-center text-sm">
                    <span class="text-sm">äºº</span>
                </div>
            </div>
            
            <div x-data="{ enableMin: false }">
                <label class="flex items-center gap-2 text-sm">
                    <input type="checkbox" @change="enableMin = $event.target.checked">
                    <span>ğŸ¯ æ¹Šåœ˜åˆ¶</span>
                </label>
                <div x-show="enableMin" class="mt-2 ml-6 space-y-2">
                    <div class="flex items-center gap-2">
                        <span class="text-sm">æœ€å°‘</span>
                        <input type="number" name="min_members" value="5" min="2" max="50"
                               class="w-14 border rounded px-2 py-1 text-center text-sm">
                        <span class="text-sm">äººæˆåœ˜</span>
                    </div>
                    <label class="flex items-center gap-2 text-sm text-gray-600">
                        <input type="checkbox" name="auto_extend" value="true">
                        <span>æœªé”äººæ•¸è‡ªå‹•å»¶é•·</span>
                    </label>
                </div>
            </div>
        </div>
        
        <!-- é€å‡º -->
        <div class="flex gap-2 pt-4" x-show="storeId" x-cloak>
            <a href="/templates" class="flex-1 py-3 text-center rounded-lg border hover:bg-gray-50">
                å–æ¶ˆ
            </a>
            <button type="submit" class="flex-1 py-3 rounded-lg bg-orange-500 hover:bg-orange-600 text-white font-medium">
                å„²å­˜æ¨¡æ¿
            </button>
        </div>
    </form>
</div>

<script>
function templateForm() {
    return {
        storeId: '',
        storeCategory: '',
        
        onStoreChange() {
            const select = document.querySelector('select[name="store_id"]');
            const option = select.options[select.selectedIndex];
            this.storeCategory = option?.dataset?.category || '';
        }
    }
}
</script>
{% endblock %}
