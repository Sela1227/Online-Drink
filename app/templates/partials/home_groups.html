<div class="space-y-6">
    
    <!-- å…¬å‘Šæ¬„ -->
    {% if announcement %}
    <div class="bg-white rounded-2xl p-4 shadow-sm border border-sela-100">
        <div class="flex items-start gap-3">
            <div class="w-10 h-10 rounded-full bg-sela-100 flex items-center justify-center flex-shrink-0">
                <span class="text-lg">ğŸ“¢</span>
            </div>
            <div class="flex-1 min-w-0">
                <div class="text-sm font-medium text-sela-700 mb-1">å…¬å‘Š</div>
                <div class="text-sm text-gray-600 whitespace-pre-line">{{ announcement }}</div>
            </div>
        </div>
    </div>
    {% endif %}
    
    <!-- é€²è¡Œä¸­çš„æŠ•ç¥¨ -->
    {% if active_votes %}
    <section>
        <div class="flex items-center justify-between mb-3">
            <h2 class="text-base font-semibold text-gray-800">æŠ•ç¥¨ä¸­</h2>
            <a href="/votes" class="text-sm text-sela-500 hover:text-sela-600">å…¨éƒ¨ â†’</a>
        </div>
        <div class="flex gap-3 overflow-x-auto pb-2 -mx-4 px-4 snap-x">
            {% for vote in active_votes[:4] %}
            <a href="/votes/{{ vote.id }}" 
               class="flex-shrink-0 w-32 bg-white rounded-2xl p-3 shadow-sm border border-gray-100 hover:border-sela-200 transition-colors snap-start">
                <div class="w-10 h-10 rounded-full bg-purple-50 flex items-center justify-center mx-auto mb-2">
                    <span class="text-lg">ğŸ—³ï¸</span>
                </div>
                <div class="text-sm font-medium text-gray-800 truncate text-center">{{ vote.title }}</div>
                <div class="flex justify-between items-center mt-2 text-xs">
                    <span class="text-purple-500">{{ vote.total_votes }}ç¥¨</span>
                    <span class="text-sela-500" x-data="countdown('{{ vote.deadline.isoformat() }}')" x-text="display"></span>
                </div>
            </a>
            {% endfor %}
        </div>
    </section>
    {% endif %}
    
    <!-- åº—å®¶åˆ—è¡¨ï¼ˆå¯æ”¶åˆï¼‰ -->
    {% if stores %}
    <section x-data="{ open: false, filter: 'all' }">
        <button @click="open = !open" class="w-full flex items-center justify-between py-2">
            <h2 class="text-base font-semibold text-gray-800 flex items-center gap-2">
                <span>ğŸª</span> åº—å®¶
                <span class="text-sm font-normal text-gray-400">({{ stores|length }})</span>
            </h2>
            <span class="text-gray-400 text-sm" x-text="open ? 'æ”¶èµ·' : 'å±•é–‹'"></span>
        </button>
        
        <div x-show="open" x-collapse class="mt-2">
            <!-- åˆ†é¡ç¯©é¸ -->
            <div class="flex gap-2 mb-3">
                <button @click="filter = 'all'" 
                        :class="filter === 'all' ? 'bg-sela-500 text-white' : 'bg-white text-gray-600 border border-gray-200'"
                        class="px-3 py-1.5 rounded-full text-xs font-medium">å…¨éƒ¨</button>
                <button @click="filter = 'drink'" 
                        :class="filter === 'drink' ? 'bg-amber-500 text-white' : 'bg-white text-gray-600 border border-gray-200'"
                        class="px-3 py-1.5 rounded-full text-xs font-medium">ğŸ§‹ é£²æ–™</button>
                <button @click="filter = 'meal'" 
                        :class="filter === 'meal' ? 'bg-green-500 text-white' : 'bg-white text-gray-600 border border-gray-200'"
                        class="px-3 py-1.5 rounded-full text-xs font-medium">ğŸ± é¤å»³</button>
                <button @click="filter = 'group_buy'" 
                        :class="filter === 'group_buy' ? 'bg-blue-500 text-white' : 'bg-white text-gray-600 border border-gray-200'"
                        class="px-3 py-1.5 rounded-full text-xs font-medium">ğŸ›’ åœ˜è³¼</button>
            </div>
            
            <!-- åº—å®¶ç¶²æ ¼ -->
            <div class="grid grid-cols-4 gap-2">
                {% for store in stores %}
                <a href="/stores/{{ store.id }}"
                   class="bg-white rounded-xl p-2 text-center hover:shadow-md transition-shadow"
                   x-show="filter === 'all' || filter === '{{ store.category.value if store.category else 'meal' }}'">
                    <div class="w-12 h-12 mx-auto bg-gray-50 rounded-xl flex items-center justify-center overflow-hidden mb-1">
                        {% if store.logo_url %}
                        <img src="{{ store.logo_url }}" class="w-10 h-10 object-contain">
                        {% else %}
                        <span class="text-xl">
                            {% if store.category and store.category.value == 'drink' %}ğŸ§‹
                            {% elif store.category and store.category.value == 'group_buy' %}ğŸ›’
                            {% else %}ğŸ±{% endif %}
                        </span>
                        {% endif %}
                    </div>
                    <div class="text-xs font-medium text-gray-700 truncate">{{ store.name }}</div>
                </a>
                {% endfor %}
            </div>
            
            <!-- æ¨è–¦åº—å®¶ -->
            <a href="/recommend" class="mt-3 flex items-center justify-center gap-1 text-sm text-sela-500 hover:text-sela-600 py-2">
                <span>ğŸ’¡</span> æˆ‘æƒ³æ¨è–¦åº—å®¶
            </a>
        </div>
    </section>
    {% endif %}
    
    <!-- é–‹æ”¾ä¸­çš„åœ˜ -->
    {% if drink_groups or meal_groups or groupbuy_groups %}
    
    <!-- é£²æ–™åœ˜ -->
    {% if drink_groups %}
    <section>
        <h2 class="text-base font-semibold text-gray-800 mb-3 flex items-center gap-2">
            <span>ğŸ§‹</span> é£²æ–™
            <span class="text-sm font-normal text-gray-400">({{ drink_groups|length }})</span>
        </h2>
        <div class="grid grid-cols-2 gap-3">
            {% for group in drink_groups %}
            {% include "partials/group_card.html" with context %}
            {% endfor %}
        </div>
    </section>
    {% endif %}

    <!-- é¤å»³åœ˜ -->
    {% if meal_groups %}
    <section>
        <h2 class="text-base font-semibold text-gray-800 mb-3 flex items-center gap-2">
            <span>ğŸ±</span> é¤å»³
            <span class="text-sm font-normal text-gray-400">({{ meal_groups|length }})</span>
        </h2>
        <div class="grid grid-cols-2 gap-3">
            {% for group in meal_groups %}
            {% include "partials/group_card.html" with context %}
            {% endfor %}
        </div>
    </section>
    {% endif %}
    
    <!-- åœ˜è³¼ -->
    {% if groupbuy_groups %}
    <section>
        <h2 class="text-base font-semibold text-gray-800 mb-3 flex items-center gap-2">
            <span>ğŸ›’</span> åœ˜è³¼
            <span class="text-sm font-normal text-gray-400">({{ groupbuy_groups|length }})</span>
        </h2>
        <div class="grid grid-cols-2 gap-3">
            {% for group in groupbuy_groups %}
            {% include "partials/group_card.html" with context %}
            {% endfor %}
        </div>
    </section>
    {% endif %}
    
    {% else %}
    <!-- ç„¡é–‹æ”¾ä¸­çš„åœ˜ -->
    <div class="text-center py-16">
        <div class="w-20 h-20 mx-auto bg-sela-50 rounded-full flex items-center justify-center mb-4">
            <span class="text-4xl">ğŸ¦</span>
        </div>
        <p class="text-gray-500 mb-1">ç›®å‰æ²’æœ‰é–‹æ”¾ä¸­çš„åœ˜</p>
        <p class="text-sm text-gray-400">é»æ“Šã€Œé–‹åœ˜ã€é–‹å§‹æªäººï¼</p>
    </div>
    {% endif %}

    <!-- å·²æˆªæ­¢ï¼ˆå¯æ”¶åˆï¼‰ -->
    {% if closed_groups %}
    <section x-data="{ open: false }">
        <button @click="open = !open" class="w-full flex items-center justify-between py-2 text-gray-400">
            <span class="text-sm">å·²æˆªæ­¢ ({{ closed_groups|length }})</span>
            <span class="text-xs" x-text="open ? 'æ”¶èµ·' : 'å±•é–‹'"></span>
        </button>
        
        <div x-show="open" x-collapse>
            <div class="grid grid-cols-2 gap-3 mt-2 opacity-50">
                {% for group in closed_groups %}
                <a href="/groups/{{ group.id }}" class="bg-gray-100 rounded-2xl p-3 text-center">
                    <div class="w-14 h-14 mx-auto bg-white rounded-xl flex items-center justify-center overflow-hidden mb-2">
                        {% if group.store.logo_url %}
                        <img src="{{ group.store.logo_url }}" class="w-12 h-12 object-contain grayscale">
                        {% else %}
                        <span class="text-2xl grayscale">
                            {% if group.category.value == 'drink' %}ğŸ§‹
                            {% elif group.category.value == 'meal' %}ğŸ±
                            {% else %}ğŸ›’{% endif %}
                        </span>
                        {% endif %}
                    </div>
                    <div class="text-sm font-medium text-gray-500 truncate">{{ group.name }}</div>
                    <div class="text-xs text-gray-400 truncate">{{ group.store.name }}</div>
                </a>
                {% endfor %}
            </div>
            <a href="/history" class="block text-center text-sm text-gray-400 mt-3 py-2 hover:text-sela-500">
                æŸ¥çœ‹å…¨éƒ¨æ­·å² â†’
            </a>
        </div>
    </section>
    {% endif %}
    
</div>
