<div class="bg-white rounded-lg shadow-sm p-4">
    <h2 class="font-semibold text-gray-800 mb-3 flex items-center gap-2">
        ğŸ›’ æˆ‘çš„è¨‚å–®
        {% if order and order.items %}
        <span class="text-sm font-normal text-gray-500">${{ order.total_amount }}</span>
        {% endif %}
        
        <!-- ç‹€æ…‹æ¨™ç±¤ -->
        {% if order %}
        {% if order.status.value == 'submitted' %}
        <span class="text-xs bg-green-100 text-green-700 px-2 py-0.5 rounded">å·²çµå–®</span>
        {% elif order.status.value == 'editing' %}
        <span class="text-xs bg-amber-100 text-amber-700 px-2 py-0.5 rounded">ä¿®æ”¹ä¸­</span>
        {% endif %}
        {% endif %}
    </h2>
    
    {% if order and order.items %}
    <!-- å“é …åˆ—è¡¨ -->
    <div class="space-y-2 mb-4">
        {% for item in order.items %}
        <div class="flex items-center gap-2 py-2 border-b last:border-b-0">
            <div class="flex-1">
                <div class="font-medium text-gray-800">{{ item.item_name }}{% if item.size %}({{ item.size }}){% endif %}</div>
                <div class="text-sm text-gray-500">
                    {% if item.sugar or item.ice %}
                    {{ item.sugar }}{% if item.sugar and item.ice %} / {% endif %}{{ item.ice }}
                    {% endif %}
                    {% for opt in item.selected_options %}
                    <span class="text-xs bg-gray-100 px-1 rounded">{{ opt.option_name }}{% if opt.price_diff > 0 %}+${{ opt.price_diff }}{% endif %}</span>
                    {% endfor %}
                </div>
                {% if item.note %}
                <div class="text-xs text-amber-600">ğŸ“ {{ item.note }}</div>
                {% endif %}
            </div>
            
            <div class="text-gray-600">${{ item.subtotal }}</div>
            
            {% if is_open and order.status.value != 'submitted' %}
            <!-- æ•¸é‡èª¿æ•´ -->
            <div class="flex items-center gap-1">
                <button hx-put="/orders/items/{{ item.id }}"
                        hx-vals='{"quantity": {{ item.quantity - 1 }}}'
                        hx-target="#my-order"
                        hx-swap="innerHTML"
                        @htmx:after-request="$dispatch('orderUpdated')"
                        class="w-7 h-7 rounded bg-gray-100 hover:bg-gray-200 text-sm">âˆ’</button>
                <span class="w-6 text-center">{{ item.quantity }}</span>
                <button hx-put="/orders/items/{{ item.id }}"
                        hx-vals='{"quantity": {{ item.quantity + 1 }}}'
                        hx-target="#my-order"
                        hx-swap="innerHTML"
                        @htmx:after-request="$dispatch('orderUpdated')"
                        class="w-7 h-7 rounded bg-gray-100 hover:bg-gray-200 text-sm">+</button>
            </div>
            
            <button hx-delete="/orders/items/{{ item.id }}"
                    hx-target="#my-order"
                    hx-swap="innerHTML"
                    hx-confirm="ç¢ºå®šè¦åˆªé™¤é€™å€‹å“é …å—ï¼Ÿ"
                    @htmx:after-request="$dispatch('orderUpdated')"
                    class="text-red-500 hover:text-red-600 text-sm">âœ•</button>
            {% else %}
            <span class="text-gray-400 text-sm">x{{ item.quantity }}</span>
            {% endif %}
        </div>
        {% endfor %}
    </div>
    
    <!-- æ“ä½œæŒ‰éˆ• -->
    {% if is_open %}
    <div class="flex gap-2">
        {% if order.status.value == 'draft' or order.status.value == 'editing' %}
        <!-- æœªçµå–®/ä¿®æ”¹ä¸­ -->
        <button hx-post="/groups/{{ group.id }}/orders/submit"
                hx-target="#my-order"
                hx-swap="innerHTML"
                @htmx:after-request="$dispatch('orderUpdated')"
                class="flex-1 py-2 rounded-lg bg-orange-500 hover:bg-orange-600 text-white font-medium">
            âœ“ ç¢ºå®šçµå–®
        </button>
        {% if order.status.value == 'editing' %}
        <button hx-post="/groups/{{ group.id }}/orders/cancel"
                hx-target="#my-order"
                hx-swap="innerHTML"
                @htmx:after-request="$dispatch('orderUpdated')"
                class="py-2 px-4 rounded-lg border hover:bg-gray-50">
            å–æ¶ˆä¿®æ”¹
        </button>
        {% endif %}
        {% else %}
        <!-- å·²çµå–® -->
        <button hx-post="/groups/{{ group.id }}/orders/edit"
                hx-target="#my-order"
                hx-swap="innerHTML"
                @htmx:after-request="$dispatch('orderUpdated')"
                class="flex-1 py-2 rounded-lg border hover:bg-gray-50">
            âœï¸ ä¿®æ”¹è¨‚å–®
        </button>
        {% endif %}
        
        <button hx-delete="/groups/{{ group.id }}/orders"
                hx-target="#my-order"
                hx-swap="innerHTML"
                hx-confirm="ç¢ºå®šè¦åˆªé™¤æ•´å¼µè¨‚å–®å—ï¼Ÿ"
                @htmx:after-request="$dispatch('orderUpdated')"
                class="py-2 px-4 rounded-lg text-red-600 border border-red-200 hover:bg-red-50">
            ğŸ—‘ï¸ åˆªé™¤
        </button>
    </div>
    {% endif %}
    
    {% else %}
    <!-- ç©ºè¨‚å–® -->
    <div class="text-center py-6 text-gray-500">
        <div class="text-2xl mb-2">ğŸ“­</div>
        <p>å°šæœªåŠ å…¥ä»»ä½•å“é …</p>
        <p class="text-sm">å¾ä¸‹æ–¹èœå–®é¸æ“‡å“é …åŠ å…¥</p>
    </div>
    {% endif %}
</div>
