# SELA å¿«é»ä¾†é»é¤ ğŸ§‹

> ä¸€å€‹ç‚º 30 äººå·¦å³åœ˜éšŠè¨­è¨ˆçš„ç¾¤çµ„è¨‚é¤ç³»çµ±ï¼Œæ”¯æ´é£²æ–™ã€é¤é»ã€åœ˜è³¼ä¸‰ç¨®é¡å‹ã€‚

**ç·šä¸Šç‰ˆæœ¬**: https://online-drink-production.up.railway.app

---

## ğŸ“‹ ç›®éŒ„

- [åŠŸèƒ½ç¸½è¦½](#åŠŸèƒ½ç¸½è¦½)
- [æŠ€è¡“æ¶æ§‹](#æŠ€è¡“æ¶æ§‹)
- [è³‡æ–™åº«è¨­è¨ˆ](#è³‡æ–™åº«è¨­è¨ˆ)
- [éƒ¨ç½²æŒ‡å—](#éƒ¨ç½²æŒ‡å—)
- [é–‹ç™¼æ³¨æ„äº‹é …](#é–‹ç™¼æ³¨æ„äº‹é …)
- [å•é¡Œèˆ‡è§£æ±ºæ–¹æ¡ˆ](#å•é¡Œèˆ‡è§£æ±ºæ–¹æ¡ˆ)
- [åŠŸèƒ½é–‹ç™¼æ­·ç¨‹](#åŠŸèƒ½é–‹ç™¼æ­·ç¨‹)

---

## åŠŸèƒ½ç¸½è¦½

### ğŸ¯ æ ¸å¿ƒåŠŸèƒ½ (66 é …)

#### Phase 0-2: åŸºç¤å»ºè¨­
- LINE Login èªè­‰ç³»çµ±
- åº—å®¶ç®¡ç†ï¼ˆCRUDã€Logo ä¸Šå‚³ï¼‰
- èœå–®ç®¡ç†ï¼ˆå“é …ã€åˆ†é¡ã€åƒ¹æ ¼ï¼‰
- åœ˜å–®ç³»çµ±ï¼ˆé–‹åœ˜ã€ä¸‹å–®ã€çµå–®ï¼‰
- è¨‚å–®ç®¡ç†ï¼ˆè‰ç¨¿ã€å·²æäº¤ã€ç·¨è¼¯ä¸­ä¸‰ç‹€æ…‹ï¼‰
- QR Code åˆ†äº«åŠŸèƒ½

#### Phase 3: é£²æ–™åº—ç‰¹åŒ–
- ç”œåº¦/å†°å¡Šé¸é …ç®¡ç†
- åŠ æ–™ç³»çµ±ï¼ˆçç ã€æ¤°æœç­‰ï¼‰
- é è¨­ç”œå†°é–å®šåŠŸèƒ½
- éš¨æ©Ÿå…å–®æŠ½ç
- ç›²é»æ¨¡å¼ï¼ˆæˆªæ­¢å‰éš±è—ä»–äººè¨‚å–®ï¼‰

#### Phase 4: åº—å®¶è³‡è¨Šå¼·åŒ–
- å¤šåˆ†åº—ç®¡ç†ï¼ˆåç¨±ã€é›»è©±ã€åœ°å€ï¼‰
- å¤–éƒ¨é€£çµæ•´åˆï¼ˆå®˜ç¶²ã€Uber Eatsã€foodpandaã€Google Mapsï¼‰
- åº—å®¶æ”¶è—åŠŸèƒ½
- èœå–®åœ–ç‰‡ï¼ˆCloudinary é›²ç«¯å­˜å„²ï¼‰

#### Phase 5: ä½¿ç”¨è€…é«”é©—
- éƒ¨é–€/ç¾¤çµ„ç³»çµ±
- åœ˜å–®å¯è¦‹ç¯„åœæ§åˆ¶ï¼ˆå…¬é–‹/é™å®šéƒ¨é–€ï¼‰
- è‡ªå‹•å‚¬å–®æé†’
- æ¹Šåœ˜åˆ¶ï¼ˆæœ€ä½æˆåœ˜äººæ•¸ï¼‰
- è¨‚å–®è¤‡è£½ï¼ˆè¤‡è£½ä¸Šæ¬¡è¨‚å–®ï¼‰
- è·Ÿå–®åŠŸèƒ½ï¼ˆè¤‡è£½ä»–äººè¨‚å–®ï¼‰

#### Phase 6: é€²éšåŠŸèƒ½
- è«‹å®¢åŠŸèƒ½ï¼ˆåœ˜ä¸»è«‹å®¢æ¨™è¨˜ï¼‰
- RWD éŸ¿æ‡‰å¼è¨­è¨ˆ
- çµ±ä¸€è¿”å›æŒ‰éˆ•
- å•é¡Œå›å ±ç³»çµ±
- JSON åŒ¯å…¥èœå–®
- é¦–é åº—å®¶åå–®ï¼ˆå¿«é€Ÿé–‹åœ˜ï¼‰

#### Phase 7: ç¤¾ç¾¤äº’å‹•
- å…¬å‘Šç³»çµ±ï¼ˆç½®é ‚ã€éæœŸã€ç·¨è¼¯ï¼‰
- å¿«é€Ÿé»é¤ï¼ˆå¸¸é»/ç†±é–€å“é …ï¼‰
- æŠ•ç¥¨ç³»çµ±ï¼ˆå¤šé¸é …ã€å¯è¦‹æ€§æ§åˆ¶ï¼‰
- æŠ•ç¥¨å°å¡ï¼ˆé¦–é ç´«è‰²ä¾¿åˆ©è²¼ï¼‰

#### Phase 8: ç‡Ÿé‹å·¥å…·
- ä½¿ç”¨è€…æ¨è–¦åº—å®¶ï¼ˆå«åœ–ç‰‡ä¸Šå‚³ï¼‰
- ç®¡ç†å“¡å¯©æ ¸æµç¨‹
- åº—å®¶éƒ¨é–€ç¶å®šï¼ˆé™å®šå¯è¦‹ç¯„åœï¼‰
- åˆ†åº—ç³»çµ±å®Œå–„

---

## æŠ€è¡“æ¶æ§‹

### å¾Œç«¯
```
Python 3.11+
â”œâ”€â”€ FastAPI          # Web æ¡†æ¶
â”œâ”€â”€ SQLAlchemy       # ORM
â”œâ”€â”€ Jinja2           # æ¨¡æ¿å¼•æ“
â”œâ”€â”€ python-jose      # JWT è™•ç†
â”œâ”€â”€ httpx            # HTTP å®¢æˆ¶ç«¯
â””â”€â”€ qrcode           # QR Code ç”Ÿæˆ
```

### å‰ç«¯
```
HTML + Tailwind CSS
â”œâ”€â”€ Alpine.js        # è¼•é‡äº’å‹•æ¡†æ¶
â”œâ”€â”€ HTMX             # å±€éƒ¨æ›´æ–°
â””â”€â”€ Tailwind CSS     # æ¨£å¼æ¡†æ¶ï¼ˆCDNï¼‰
```

### è³‡æ–™åº«
```
PostgreSQL (Railway æä¾›)
```

### é›²ç«¯æœå‹™
```
â”œâ”€â”€ Railway          # éƒ¨ç½²å¹³å°
â”œâ”€â”€ Cloudinary       # åœ–ç‰‡å­˜å„²
â””â”€â”€ LINE Login       # ç¬¬ä¸‰æ–¹èªè­‰
```

### å°ˆæ¡ˆçµæ§‹
```
ç·šä¸Šè¨‚é¤/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ main.py              # æ‡‰ç”¨å…¥å£ + è³‡æ–™åº«é·ç§»
â”‚   â”œâ”€â”€ config.py            # ç’°å¢ƒè¨­å®š
â”‚   â”œâ”€â”€ database.py          # è³‡æ–™åº«é€£ç·š
â”‚   â”œâ”€â”€ models/              # SQLAlchemy Models
â”‚   â”‚   â”œâ”€â”€ user.py          # User, Feedback, StoreRecommendation
â”‚   â”‚   â”œâ”€â”€ store.py         # Store, StoreBranch, StoreOption, StoreTopping
â”‚   â”‚   â”œâ”€â”€ menu.py          # Menu, MenuItem, MenuCategory
â”‚   â”‚   â”œâ”€â”€ group.py         # Group
â”‚   â”‚   â”œâ”€â”€ order.py         # Order, OrderItem
â”‚   â”‚   â”œâ”€â”€ department.py    # Department, UserDepartment, GroupDepartment, StoreDepartment
â”‚   â”‚   â”œâ”€â”€ vote.py          # Vote, VoteOption, VoteRecord
â”‚   â”‚   â””â”€â”€ template.py      # GroupTemplate
â”‚   â”œâ”€â”€ routers/             # API è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ auth.py          # LINE Login èªè­‰
â”‚   â”‚   â”œâ”€â”€ home.py          # é¦–é ã€å€‹äººè³‡æ–™
â”‚   â”‚   â”œâ”€â”€ groups.py        # åœ˜å–®æ“ä½œ
â”‚   â”‚   â”œâ”€â”€ orders.py        # è¨‚å–®æ“ä½œ
â”‚   â”‚   â”œâ”€â”€ admin.py         # å¾Œå°ç®¡ç†
â”‚   â”‚   â””â”€â”€ votes.py         # æŠ•ç¥¨ç³»çµ±
â”‚   â”œâ”€â”€ services/            # æ¥­å‹™é‚è¼¯
â”‚   â”‚   â”œâ”€â”€ auth.py          # èªè­‰æœå‹™
â”‚   â”‚   â””â”€â”€ export_service.py # åŒ¯å‡ºæœå‹™
â”‚   â””â”€â”€ templates/           # Jinja2 æ¨¡æ¿
â”‚       â”œâ”€â”€ base.html        # åŸºç¤æ¨¡æ¿
â”‚       â”œâ”€â”€ home.html        # é¦–é 
â”‚       â”œâ”€â”€ group.html       # åœ˜å–®é 
â”‚       â”œâ”€â”€ group_new.html   # é–‹åœ˜é 
â”‚       â”œâ”€â”€ partials/        # å¯é‡ç”¨çµ„ä»¶
â”‚       â”‚   â”œâ”€â”€ home_groups.html
â”‚       â”‚   â””â”€â”€ group_card.html
â”‚       â””â”€â”€ admin/           # å¾Œå°æ¨¡æ¿
â”œâ”€â”€ static/                  # éœæ…‹è³‡æº
â”œâ”€â”€ requirements.txt         # Python ä¾è³´
â”œâ”€â”€ railway.toml             # Railway è¨­å®š
â”œâ”€â”€ Dockerfile               # Docker è¨­å®šï¼ˆå‚™ç”¨ï¼‰
â””â”€â”€ start.sh                 # å•Ÿå‹•è…³æœ¬ï¼ˆå‚™ç”¨ï¼‰
```

---

## è³‡æ–™åº«è¨­è¨ˆ

### ER é—œä¿‚åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    User     â”‚â”€â”€â”€â”€<â”‚   Order     â”‚>â”€â”€â”€â”€â”‚    Group    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                   â”‚                   â”‚
       â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”            â”‚
       â”‚            â”‚  OrderItem  â”‚            â”‚
       â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
       â”‚                                       â”‚
       â”œâ”€â”€< UserDepartment >â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
       â”‚                      â”‚                â”‚
       â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”        â”‚
       â”‚              â”‚  Department   â”‚        â”‚
       â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
       â”‚                      â”‚                â”‚
       â”‚              GroupDepartment >â”€â”€â”€â”€â”€â”€â”€â”€â”¤
       â”‚              StoreDepartment >â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€< Store
       â”‚                                       â”‚        â”‚
       â”‚                                       â”‚   StoreBranch
       â”‚                                       â”‚   StoreOption
       â”‚                                       â”‚   StoreTopping
       â”‚                                       â”‚        â”‚
       â”‚                               â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”¤
       â”‚                               â”‚     Menu       â”‚
       â”‚                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
       â”‚                                       â”‚        â”‚
       â”‚                               MenuCategory  MenuItem
       â”‚
       â”œâ”€â”€< Vote >â”€â”€< VoteOption >â”€â”€< VoteRecord
       â”‚
       â”œâ”€â”€< Feedback
       â”‚
       â””â”€â”€< StoreRecommendation
```

### ä¸»è¦è³‡æ–™è¡¨

#### users
| æ¬„ä½ | é¡å‹ | èªªæ˜ |
|------|------|------|
| id | SERIAL | ä¸»éµ |
| line_user_id | VARCHAR(100) | LINE ç”¨æˆ¶ ID |
| display_name | VARCHAR(100) | LINE é¡¯ç¤ºåç¨± |
| nickname | VARCHAR(100) | è‡ªè¨‚æš±ç¨± |
| picture_url | VARCHAR(500) | å¤§é ­è²¼ |
| is_admin | BOOLEAN | ç®¡ç†å“¡ |
| is_guest | BOOLEAN | è¨ªå®¢æ¨¡å¼ |
| last_login_at | TIMESTAMP | æœ€å¾Œç™»å…¥ |
| last_active_at | TIMESTAMP | æœ€å¾Œæ´»å‹• |

#### stores
| æ¬„ä½ | é¡å‹ | èªªæ˜ |
|------|------|------|
| id | SERIAL | ä¸»éµ |
| name | VARCHAR(100) | åº—å |
| category | ENUM | DRINK/MEAL/GROUP_BUY |
| logo_url | VARCHAR(500) | Logo åœ–ç‰‡ |
| phone | VARCHAR(50) | é›»è©± |
| address | VARCHAR(300) | åœ°å€ |
| website_url | VARCHAR(500) | å®˜ç¶² |
| ubereats_url | VARCHAR(500) | Uber Eats |
| foodpanda_url | VARCHAR(500) | foodpanda |
| google_maps_url | VARCHAR(500) | Google Maps |
| is_active | BOOLEAN | å•Ÿç”¨ç‹€æ…‹ |
| is_public | BOOLEAN | å…¬é–‹/é™å®šéƒ¨é–€ |

#### groups
| æ¬„ä½ | é¡å‹ | èªªæ˜ |
|------|------|------|
| id | SERIAL | ä¸»éµ |
| store_id | INTEGER | åº—å®¶ FK |
| menu_id | INTEGER | èœå–® FK |
| owner_id | INTEGER | åœ˜ä¸» FK |
| branch_id | INTEGER | åˆ†åº— FK |
| name | VARCHAR(100) | åœ˜å |
| note | TEXT | å‚™è¨» |
| category | ENUM | åˆ†é¡ |
| deadline | TIMESTAMP | æˆªæ­¢æ™‚é–“ |
| is_closed | BOOLEAN | æ‰‹å‹•æˆªæ­¢ |
| is_public | BOOLEAN | å…¬é–‹/é™å®šéƒ¨é–€ |
| delivery_fee | NUMERIC | å¤–é€è²» |
| default_sugar | VARCHAR(50) | é è¨­ç”œåº¦ |
| default_ice | VARCHAR(50) | é è¨­å†°å¡Š |
| lock_sugar | BOOLEAN | é–å®šç”œåº¦ |
| lock_ice | BOOLEAN | é–å®šå†°å¡Š |
| is_blind_mode | BOOLEAN | ç›²é»æ¨¡å¼ |
| enable_lucky_draw | BOOLEAN | å•Ÿç”¨æŠ½ç |
| lucky_draw_count | INTEGER | å…å–®äººæ•¸ |
| lucky_winner_ids | TEXT | ä¸­çè€… |
| treat_user_id | INTEGER | è«‹å®¢è€… |
| min_members | INTEGER | æœ€ä½æˆåœ˜äººæ•¸ |
| auto_extend | BOOLEAN | è‡ªå‹•å»¶é•· |

#### orders
| æ¬„ä½ | é¡å‹ | èªªæ˜ |
|------|------|------|
| id | SERIAL | ä¸»éµ |
| group_id | INTEGER | åœ˜å–® FK |
| user_id | INTEGER | ç”¨æˆ¶ FK |
| status | ENUM | DRAFT/SUBMITTED/EDITING |
| total_amount | NUMERIC | ç¸½é‡‘é¡ |
| created_at | TIMESTAMP | å»ºç«‹æ™‚é–“ |

#### order_items
| æ¬„ä½ | é¡å‹ | èªªæ˜ |
|------|------|------|
| id | SERIAL | ä¸»éµ |
| order_id | INTEGER | è¨‚å–® FK |
| menu_item_id | INTEGER | å“é … FK |
| item_name | VARCHAR(100) | å“é …åç¨± |
| quantity | INTEGER | æ•¸é‡ |
| unit_price | NUMERIC | å–®åƒ¹ |
| size | VARCHAR(20) | å°ºå¯¸ |
| sugar | VARCHAR(50) | ç”œåº¦ |
| ice | VARCHAR(50) | å†°å¡Š |
| note | TEXT | å‚™è¨» |

---

## éƒ¨ç½²æŒ‡å—

### Railway éƒ¨ç½²

#### 1. ç’°å¢ƒè®Šæ•¸è¨­å®š
```env
# è³‡æ–™åº«ï¼ˆRailway è‡ªå‹•æä¾›ï¼‰
DATABASE_URL=postgresql://...

# LINE Login
LINE_CHANNEL_ID=your_channel_id
LINE_CHANNEL_SECRET=your_channel_secret
LINE_CALLBACK_URL=https://your-app.up.railway.app/auth/callback

# JWT
JWT_SECRET_KEY=your_secret_key

# Cloudinaryï¼ˆåœ–ç‰‡ä¸Šå‚³ï¼‰
CLOUDINARY_CLOUD_NAME=your_cloud_name
CLOUDINARY_API_KEY=your_api_key
CLOUDINARY_API_SECRET=your_api_secret
```

#### 2. railway.toml
```toml
[build]
builder = "nixpacks"

[deploy]
startCommand = "uvicorn app.main:app --host 0.0.0.0 --port $PORT"
healthcheckPath = "/"
healthcheckTimeout = 300
restartPolicyType = "on_failure"
restartPolicyMaxRetries = 3
```

#### 3. requirements.txt
```txt
fastapi==0.109.0
uvicorn==0.27.0
sqlalchemy==2.0.25
psycopg2-binary==2.9.9
python-jose==3.3.0
httpx==0.26.0
python-multipart==0.0.6
jinja2==3.1.3
qrcode==7.4.2
pillow==10.2.0
cloudinary==1.38.0
```

### LINE Login è¨­å®š

1. åˆ° [LINE Developers Console](https://developers.line.biz/)
2. å»ºç«‹ Provider å’Œ Channel (LINE Login)
3. è¨­å®š Callback URL: `https://your-app.up.railway.app/auth/callback`
4. å–å¾— Channel ID å’Œ Channel Secret

---

## é–‹ç™¼æ³¨æ„äº‹é …

### âš ï¸ Railway éƒ¨ç½²é‡é»

#### 1. ä¸è¦ä½¿ç”¨ Alembic
```python
# âŒ éŒ¯èª¤ï¼šä¸è¦åœ¨ railway.toml æˆ– requirements.txt åŒ…å« alembic
startCommand = "alembic upgrade head && uvicorn..."

# âœ… æ­£ç¢ºï¼šä½¿ç”¨ SQLAlchemy è‡ªå‹•å»ºè¡¨ + æ‰‹å‹•é·ç§»
# åœ¨ app/main.py çš„ startup äº‹ä»¶ä¸­è™•ç†
```

#### 2. PostgreSQL Enum è™•ç†
```python
# âŒ éŒ¯èª¤ï¼šç›´æ¥ä¿®æ”¹ Python Enum å®šç¾©
class CategoryType(str, Enum):
    DRINK = "drink"
    MEAL = "meal"
    GROUP_BUY = "group_buy"  # æ–°å¢å€¼

# âœ… æ­£ç¢ºï¼šä½¿ç”¨ Raw SQL æ–°å¢ Enum å€¼ï¼ˆå¤§å¯«ï¼‰
def add_enum_value_if_not_exists(enum_name: str, new_value: str):
    with engine.begin() as conn:
        conn.execute(text(f"ALTER TYPE {enum_name} ADD VALUE IF NOT EXISTS '{new_value}'"))
```

#### 3. æ–°å¢æ¬„ä½çš„å®‰å…¨æ–¹å¼
```python
def add_column_if_not_exists(table: str, column: str, definition: str):
    try:
        with engine.begin() as conn:
            conn.execute(text(f"ALTER TABLE {table} ADD COLUMN {column} {definition}"))
    except Exception as e:
        if "already exists" not in str(e):
            raise
```

#### 4. Nixpacks å»ºç½®å¤±æ•—æ™‚çš„å‚™æ¡ˆ
```toml
# railway.toml
[build]
builder = "dockerfile"

# Dockerfile
FROM python:3.11-slim
WORKDIR /app
COPY requirements.txt .
RUN pip install -r requirements.txt
COPY . .
CMD ["sh", "start.sh"]
```

### ğŸ”§ å¸¸è¦‹å•é¡Œæª¢æŸ¥æ¸…å–®

1. **éƒ¨ç½²å¾Œ 500 éŒ¯èª¤**
   - æª¢æŸ¥ Railway Logs
   - ç¢ºèªç’°å¢ƒè®Šæ•¸è¨­å®šæ­£ç¢º
   - ç¢ºèªè³‡æ–™åº«é·ç§»å®Œæˆ

2. **LINE Login å¤±æ•—**
   - ç¢ºèª Callback URL å®Œå…¨ä¸€è‡´
   - ç¢ºèª Channel ID/Secret æ­£ç¢º
   - æª¢æŸ¥ LINE Developers Console è¨­å®š

3. **åœ–ç‰‡ä¸Šå‚³å¤±æ•—**
   - ç¢ºèª Cloudinary è¨­å®šæ­£ç¢º
   - æª¢æŸ¥æª”æ¡ˆå¤§å°é™åˆ¶

4. **è¡¨å–®æäº¤å¤±æ•—**
   - æª¢æŸ¥ Form æ¬„ä½åç¨±æ˜¯å¦åŒ¹é…
   - ç¢ºèª enctype="multipart/form-data"ï¼ˆä¸Šå‚³æª”æ¡ˆæ™‚ï¼‰

---

## å•é¡Œèˆ‡è§£æ±ºæ–¹æ¡ˆ

### å•é¡Œ 1: taipei_tz æœªå®šç¾©
**éŒ¯èª¤è¨Šæ¯**: `NameError: name 'taipei_tz' is not defined`

**åŸå› **: åœ¨ groups.py ä¸­ä½¿ç”¨äº†æœªå®šç¾©çš„è®Šæ•¸

**è§£æ±ºæ–¹æ¡ˆ**:
```python
# åœ¨æª”æ¡ˆé–‹é ­å®šç¾©å…¨å±€å¸¸æ•¸
from datetime import timezone, timedelta
TAIPEI_TZ = timezone(timedelta(hours=8))

# ä½¿ç”¨æ™‚
thirty_days_ago = datetime.now(TAIPEI_TZ).replace(tzinfo=None) - timedelta(days=30)
```

### å•é¡Œ 2: Enum å€¼æ–°å¢å¤±æ•—
**éŒ¯èª¤è¨Šæ¯**: `invalid input value for enum categorytype: "GROUP_BUY"`

**åŸå› **: PostgreSQL Enum ä½¿ç”¨å¤§å¯«ï¼Œä½†ç¨‹å¼å‚³å…¥å°å¯«

**è§£æ±ºæ–¹æ¡ˆ**:
```python
# PostgreSQL ä¸­ Enum å€¼æ˜¯å¤§å¯«
# æ–°å¢æ™‚ç”¨å¤§å¯«
ALTER TYPE categorytype ADD VALUE IF NOT EXISTS 'GROUP_BUY';

# æŸ¥è©¢æ™‚ SQLAlchemy æœƒè‡ªå‹•è½‰æ›
```

### å•é¡Œ 3: é‡è¤‡æŠ•ç¥¨
**éŒ¯èª¤è¨Šæ¯**: ä½¿ç”¨è€…å¯ä»¥å°åŒä¸€é¸é …é‡è¤‡æŠ•ç¥¨

**è§£æ±ºæ–¹æ¡ˆ**:
```python
# 1. è³‡æ–™åº«åŠ å…¥å”¯ä¸€ç´„æŸ
ALTER TABLE vote_records 
ADD CONSTRAINT vote_records_option_user_unique 
UNIQUE (option_id, user_id);

# 2. ç¨‹å¼ç¢¼æª¢æŸ¥
existing = db.query(VoteRecord).filter(
    VoteRecord.option_id == option_id,
    VoteRecord.user_id == user.id
).first()
if existing:
    return  # å·²æŠ•é
```

### å•é¡Œ 4: è¡¨å–®æª”æ¡ˆä¸Šå‚³
**éŒ¯èª¤è¨Šæ¯**: æª”æ¡ˆæ¬„ä½æ”¶åˆ°ç©ºå€¼

**è§£æ±ºæ–¹æ¡ˆ**:
```html
<!-- è¡¨å–®å¿…é ˆæœ‰ enctype -->
<form method="POST" enctype="multipart/form-data">
    <input type="file" name="menu_image">
</form>
```

```python
# è·¯ç”±è¦ç”¨ UploadFile
from fastapi import UploadFile, File

async def submit(menu_image: UploadFile = File(None)):
    if menu_image and menu_image.filename:
        contents = await menu_image.read()
```

### å•é¡Œ 5: éƒ¨é–€éæ¿¾é‚è¼¯
**éœ€æ±‚**: éå…¬é–‹åº—å®¶åªå°ç¶å®šéƒ¨é–€æˆå“¡é¡¯ç¤º

**è§£æ±ºæ–¹æ¡ˆ**:
```python
# å–å¾—ç”¨æˆ¶éƒ¨é–€
user_dept_ids = [ud.department_id for ud in db.query(UserDepartment).filter(
    UserDepartment.user_id == user.id
).all()]

# éæ¿¾å¯è¦‹åº—å®¶
visible_stores = []
for store in all_stores:
    if store.is_public:
        visible_stores.append(store)
    elif user.is_admin:
        visible_stores.append(store)
    else:
        store_dept_ids = {sd.department_id for sd in db.query(StoreDepartment).filter(
            StoreDepartment.store_id == store.id
        ).all()}
        if store_dept_ids & set(user_dept_ids):
            visible_stores.append(store)
```

---

## åŠŸèƒ½é–‹ç™¼æ­·ç¨‹

### Phase 0-2 (åŸºç¤)
- å»ºç«‹å°ˆæ¡ˆæ¶æ§‹
- LINE Login æ•´åˆ
- åŸºæœ¬ CRUD åŠŸèƒ½
- è¨‚å–®æµç¨‹

### Phase 3 (é£²æ–™ç‰¹åŒ–)
- ç”œå†°é¸é …ç³»çµ±
- åŠ æ–™åŠŸèƒ½
- è¶£å‘³åŠŸèƒ½ï¼ˆæŠ½çã€ç›²é»ï¼‰

### Phase 4 (åº—å®¶å¼·åŒ–)
- åˆ†åº—ç®¡ç†
- å¤–éƒ¨é€£çµ
- åœ–ç‰‡ä¸Šå‚³

### Phase 5 (ä½¿ç”¨è€…é«”é©—)
- éƒ¨é–€ç³»çµ±
- æ¬Šé™æ§åˆ¶
- è¨‚å–®è¤‡è£½

### Phase 6 (é€²éšåŠŸèƒ½)
- è«‹å®¢åŠŸèƒ½
- RWD å„ªåŒ–
- å•é¡Œå›å ±
- JSON åŒ¯å…¥

### Phase 7 (ç¤¾ç¾¤äº’å‹•)
- å…¬å‘Šç³»çµ±
- å¿«é€Ÿé»é¤
- æŠ•ç¥¨ç³»çµ±

### Phase 8 (ç‡Ÿé‹å·¥å…·)
- æ¨è–¦åº—å®¶
- å¯©æ ¸æµç¨‹
- åº—å®¶éƒ¨é–€ç¶å®š

---

## æˆæ¬Š

MIT License

---

## è¯çµ¡

å¦‚æœ‰å•é¡Œï¼Œè«‹é€éç³»çµ±å…§çš„ã€Œå•é¡Œå›å ±ã€åŠŸèƒ½åæ˜ ã€‚
